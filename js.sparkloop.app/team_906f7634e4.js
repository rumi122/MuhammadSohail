(function() {
  window.SLConfig = {"active":true,"disabled":false,"test_mode":false,"scan_forms":true,"app_url":"https://dash.sparkloop.app","script_url":"https://js.sparkloop.app","upscribe_page_hostname":"upscribe.page","uuid":"team_906f7634e4","plan":"convertkit_pro","provider":"convertkit","form_selector":"form","campaigns":true,"widgets":{"referral_hubs":[{"campaign_id":"MFdf5f7d01dc","styling":{"colors":{"primary":"#0b5394","secondary":"#eeeeee","headers":"#4b5563"},"custom_css":"#sl-form-screen {}\r\n#sl-form-screen \u003e section {}\r\n#sl-form-screen \u003e section h2 {}","powered_by_enabled":false},"form_widget":{"cover_image":{"enabled":false,"url":"https://dash.sparkloop.app/images/placeholder-image.jpg","position":"left"},"header":"Share Sunday Snippets, Earn Rewards","subheader":"Get your friends to subscribe and earn rewards. The more subscribers you refer, the bigger the rewards.","form":{"name_input":{"enabled":true,"placeholder":"Your name"},"email_input":{"placeholder":"Your email"},"button":{"label":"Join"}},"tabs":{"how_it_works":{"enabled":true,"label":"How it works","content":"Share **Newsletter Name** and Earn Rewards When Friends You Refer Subscribe:\r\n\r\n- Refer 3 friends to redeem Ali's 50+ creator sources\r\n- Refer 5 friends to redeem Ali's templates he uses for life and business\r\n- Refer 10 friends to redeem Ali's guide to the 4 most important areas of life: health, wealth, love, and  happiness\r\n- Refer 50 friends to access 2 free courses: the camera confidence course and YouTube for beginners\r\n- Refer 100 friends to access Ali's coaching database\r\n\r\nQuestions? Email us at support@aliabdaal.com"},"terms":{"enabled":false,"label":"Terms \u0026 Conditions","url":""}}},"hub_widget":{"header":"Share Sunday Snippets, Get Rewards","subheader":"","rewards":{"enabled":true,"layout":"horizontal","list":[{"id":"reward_e0db7c59c9","image":"https://dash.sparkloop.app/rails/active_storage/representations/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBBcTR0IiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--c73a9d938c48cf317c4117407147877261e82324/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaDdCam9MY21WemFYcGxTU0lPTXpBd1BuZ3pNREErQmpvR1JWUT0iLCJleHAiOm51bGwsInB1ciI6InZhcmlhdGlvbiJ9fQ==--83ff9a9dbb0569e1243b731eed72c73e23168436/creator%20sources.jpeg","name":"Ali's List of 50+ Creator Sources","description":"My personal list of 50+ creator sources that I use whenever I'm creating content.","referrals":3,"recurring":false},{"id":"reward_914c2e3aa8","image":"https://dash.sparkloop.app/rails/active_storage/representations/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBBcEJGIiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--8ef40d02c17ce4c5dc9f484d058d211064f7e8b8/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaDdCam9MY21WemFYcGxTU0lPTXpBd1BuZ3pNREErQmpvR1JWUT0iLCJleHAiOm51bGwsInB1ciI6InZhcmlhdGlvbiJ9fQ==--83ff9a9dbb0569e1243b731eed72c73e23168436/Screenshot%202023-03-08%20at%2017.14.37.png","name":"Life and Business Templates","description":"The templates I use to manage my life and my business e.g. scripting, planning, articles. etc. ","referrals":5,"recurring":false},{"id":"reward_ee47b3f26a","image":"https://dash.sparkloop.app/rails/active_storage/representations/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBBckF0IiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--e0a1422b3fce2e5ab6f4bb79e087bc56061930a5/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaDdCam9MY21WemFYcGxTU0lPTXpBd1BuZ3pNREErQmpvR1JWUT0iLCJleHAiOm51bGwsInB1ciI6InZhcmlhdGlvbiJ9fQ==--83ff9a9dbb0569e1243b731eed72c73e23168436/parttimelife.png","name":"Ali's Guide to Life","description":"Subscriber-only guides on the 4 most important areas of my life: Wealth, Health, Love \u0026 Happiness. ","referrals":10,"recurring":false},{"id":"reward_2656ed6e06bb","image":"https://dash.sparkloop.app/rails/active_storage/representations/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBBcEpGIiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--652c53ca08820d175e5ae7cbfbe8b80201483aaf/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaDdCam9MY21WemFYcGxTU0lPTXpBd1BuZ3pNREErQmpvR1JWUT0iLCJleHAiOm51bGwsInB1ciI6InZhcmlhdGlvbiJ9fQ==--83ff9a9dbb0569e1243b731eed72c73e23168436/632491596344b8992f341c09_Courses%20Devices%20Hero%20bigger-p-1600.png","name":"Free Access to 2 Courses","description":"Free access to the Camera Confidence + YouTube For Beginners courses","referrals":50,"recurring":false},{"id":"reward_39f489e3597d","image":"https://dash.sparkloop.app/rails/active_storage/representations/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBBcEZGIiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--88ca25717e86baf436042415b6e1d22d6318b6a1/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaDdCam9MY21WemFYcGxTU0lPTXpBd1BuZ3pNREErQmpvR1JWUT0iLCJleHAiOm51bGwsInB1ciI6InZhcmlhdGlvbiJ9fQ==--83ff9a9dbb0569e1243b731eed72c73e23168436/1663254449027.jpeg","name":"Ali's Coaching Database","description":"Free access to the recordings from Aliâ€™s coaching database ","referrals":100,"recurring":false}]},"sharing":{"referral_link":{"header":"Share your link","button":{"label":"Copy Link"}},"social_links":{"enabled":true,"header":"Or share with:","socials":{"twitter":{"enabled":true,"message":"I just signed up on this awesome newsletter!"},"facebook":{"enabled":true},"facebook_messenger":{"enabled":true},"email":{"enabled":true,"message":"I just signed up on this awesome newsletter!","subject":"Check this out"},"whatsapp":{"enabled":true,"message":"I just signed up on this awesome newsletter!"},"linkedin":{"enabled":true},"telegram":{"enabled":true,"message":"I just signed up on this awesome newsletter!"},"line":{"enabled":false,"message":"I just signed up on this awesome newsletter!"}}},"email_invitation":{"enabled":true,"header":"Send to friends via email","placeholder":"Comma separated emails (max 5)","button":{"label":"Send"},"confirmation_message":"The invites have been sent","email":{"subject":"Check this out","body":"Hey, I highly recommend giving Sunday Snippets a read. It's an awesome daily email sharing a ton of tips on how to live your best life. Best of all, it's free, and only takes 5 minutes to read.\r\n\r\nGive it a try and subscribe using my personal invite link below:"}}},"referrals":{"confirmed":{"enabled":true,"label":"confirmed referrals"},"pending":{"enabled":true,"label":"pending referrals"},"next":{"enabled":true,"label":"referrals to next reward"}}}}],"upscribes":[{"enabled":false,"uuid":"upscribe_2b541ada727d","selector":"form","recommendations":[],"recs_stats":[5,0,0,0],"header":"You're subscribed!","subheader":"Ali Abdaal recommends...","button_label":"Subscribe to these publications","skip_link":"Maybe later","after_submission":{"redirect":true,"redirect_url":"https://","thank_you_message":"Thank you for subscribing!"},"visibility":{"installation":null,"all_pages":true,"rules":[]},"styling":{"colors":{"primary":"#d742a8"},"custom_css":"/* Upscribe main container */\n#sparkloop-upscribe {}\n\n/* Header */\n#sparkloop-upscribe form \u003e header {}\n  #sparkloop-upscribe form \u003e header h2 {}\n\n/* Recommendations */\n#sparkloop-upscribe form \u003e ul {}\n#sparkloop-upscribe form \u003e ul li {}\n\n  /* Recommendation's image */\n  #sparkloop-upscribe form \u003e ul li label main \u003e figure {}\n\n  /* Recommendation's copy */\n  #sparkloop-upscribe form \u003e ul li label main \u003e div h3 {}\n  #sparkloop-upscribe form \u003e ul li label main \u003e div p {}\n\n/* Footer */\n#sparkloop-upscribe form \u003e footer {}\n  /* Button */\n  #sparkloop-upscribe form \u003e footer .sl-button {}\n  /* \"Maybe later\" link */\n  #sparkloop-upscribe form \u003e footer \u003e a.sl-skip-link {}\n","powered_by_enabled":true}}],"upscribe_ref":"sparkloop-upscribe"}};
  (() => {
  var __create = Object.create;
  var __defProp = Object.defineProperty;
  var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
  var __getOwnPropNames = Object.getOwnPropertyNames;
  var __getProtoOf = Object.getPrototypeOf;
  var __hasOwnProp = Object.prototype.hasOwnProperty;
  var __commonJS = (cb, mod) => function __require() {
    return mod || (0, cb[__getOwnPropNames(cb)[0]])((mod = { exports: {} }).exports, mod), mod.exports;
  };
  var __copyProps = (to, from, except, desc) => {
    if (from && typeof from === "object" || typeof from === "function") {
      for (let key of __getOwnPropNames(from))
        if (!__hasOwnProp.call(to, key) && key !== except)
          __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
    }
    return to;
  };
  var __toESM = (mod, isNodeMode, target) => (target = mod != null ? __create(__getProtoOf(mod)) : {}, __copyProps(
    isNodeMode || !mod || !mod.__esModule ? __defProp(target, "default", { value: mod, enumerable: true }) : target,
    mod
  ));

  // node_modules/fingerprintjs2/fingerprint2.js
  var require_fingerprint2 = __commonJS({
    "node_modules/fingerprintjs2/fingerprint2.js"(exports, module) {
      (function(name, context, definition) {
        "use strict";
        if (typeof window !== "undefined" && typeof define === "function" && define.amd) {
          define(definition);
        } else if (typeof module !== "undefined" && module.exports) {
          module.exports = definition();
        } else if (context.exports) {
          context.exports = definition();
        } else {
          context[name] = definition();
        }
      })("Fingerprint2", exports, function() {
        "use strict";
        if (typeof Array.isArray === "undefined") {
          Array.isArray = function(obj) {
            return Object.prototype.toString.call(obj) === "[object Array]";
          };
        }
        ;
        var x64Add = function(m, n2) {
          m = [m[0] >>> 16, m[0] & 65535, m[1] >>> 16, m[1] & 65535];
          n2 = [n2[0] >>> 16, n2[0] & 65535, n2[1] >>> 16, n2[1] & 65535];
          var o = [0, 0, 0, 0];
          o[3] += m[3] + n2[3];
          o[2] += o[3] >>> 16;
          o[3] &= 65535;
          o[2] += m[2] + n2[2];
          o[1] += o[2] >>> 16;
          o[2] &= 65535;
          o[1] += m[1] + n2[1];
          o[0] += o[1] >>> 16;
          o[1] &= 65535;
          o[0] += m[0] + n2[0];
          o[0] &= 65535;
          return [o[0] << 16 | o[1], o[2] << 16 | o[3]];
        };
        var x64Multiply = function(m, n2) {
          m = [m[0] >>> 16, m[0] & 65535, m[1] >>> 16, m[1] & 65535];
          n2 = [n2[0] >>> 16, n2[0] & 65535, n2[1] >>> 16, n2[1] & 65535];
          var o = [0, 0, 0, 0];
          o[3] += m[3] * n2[3];
          o[2] += o[3] >>> 16;
          o[3] &= 65535;
          o[2] += m[2] * n2[3];
          o[1] += o[2] >>> 16;
          o[2] &= 65535;
          o[2] += m[3] * n2[2];
          o[1] += o[2] >>> 16;
          o[2] &= 65535;
          o[1] += m[1] * n2[3];
          o[0] += o[1] >>> 16;
          o[1] &= 65535;
          o[1] += m[2] * n2[2];
          o[0] += o[1] >>> 16;
          o[1] &= 65535;
          o[1] += m[3] * n2[1];
          o[0] += o[1] >>> 16;
          o[1] &= 65535;
          o[0] += m[0] * n2[3] + m[1] * n2[2] + m[2] * n2[1] + m[3] * n2[0];
          o[0] &= 65535;
          return [o[0] << 16 | o[1], o[2] << 16 | o[3]];
        };
        var x64Rotl = function(m, n2) {
          n2 %= 64;
          if (n2 === 32) {
            return [m[1], m[0]];
          } else if (n2 < 32) {
            return [m[0] << n2 | m[1] >>> 32 - n2, m[1] << n2 | m[0] >>> 32 - n2];
          } else {
            n2 -= 32;
            return [m[1] << n2 | m[0] >>> 32 - n2, m[0] << n2 | m[1] >>> 32 - n2];
          }
        };
        var x64LeftShift = function(m, n2) {
          n2 %= 64;
          if (n2 === 0) {
            return m;
          } else if (n2 < 32) {
            return [m[0] << n2 | m[1] >>> 32 - n2, m[1] << n2];
          } else {
            return [m[1] << n2 - 32, 0];
          }
        };
        var x64Xor = function(m, n2) {
          return [m[0] ^ n2[0], m[1] ^ n2[1]];
        };
        var x64Fmix = function(h) {
          h = x64Xor(h, [0, h[0] >>> 1]);
          h = x64Multiply(h, [4283543511, 3981806797]);
          h = x64Xor(h, [0, h[0] >>> 1]);
          h = x64Multiply(h, [3301882366, 444984403]);
          h = x64Xor(h, [0, h[0] >>> 1]);
          return h;
        };
        var x64hash128 = function(key, seed) {
          key = key || "";
          seed = seed || 0;
          var remainder = key.length % 16;
          var bytes = key.length - remainder;
          var h1 = [0, seed];
          var h2 = [0, seed];
          var k1 = [0, 0];
          var k2 = [0, 0];
          var c1 = [2277735313, 289559509];
          var c2 = [1291169091, 658871167];
          for (var i = 0; i < bytes; i = i + 16) {
            k1 = [key.charCodeAt(i + 4) & 255 | (key.charCodeAt(i + 5) & 255) << 8 | (key.charCodeAt(i + 6) & 255) << 16 | (key.charCodeAt(i + 7) & 255) << 24, key.charCodeAt(i) & 255 | (key.charCodeAt(i + 1) & 255) << 8 | (key.charCodeAt(i + 2) & 255) << 16 | (key.charCodeAt(i + 3) & 255) << 24];
            k2 = [key.charCodeAt(i + 12) & 255 | (key.charCodeAt(i + 13) & 255) << 8 | (key.charCodeAt(i + 14) & 255) << 16 | (key.charCodeAt(i + 15) & 255) << 24, key.charCodeAt(i + 8) & 255 | (key.charCodeAt(i + 9) & 255) << 8 | (key.charCodeAt(i + 10) & 255) << 16 | (key.charCodeAt(i + 11) & 255) << 24];
            k1 = x64Multiply(k1, c1);
            k1 = x64Rotl(k1, 31);
            k1 = x64Multiply(k1, c2);
            h1 = x64Xor(h1, k1);
            h1 = x64Rotl(h1, 27);
            h1 = x64Add(h1, h2);
            h1 = x64Add(x64Multiply(h1, [0, 5]), [0, 1390208809]);
            k2 = x64Multiply(k2, c2);
            k2 = x64Rotl(k2, 33);
            k2 = x64Multiply(k2, c1);
            h2 = x64Xor(h2, k2);
            h2 = x64Rotl(h2, 31);
            h2 = x64Add(h2, h1);
            h2 = x64Add(x64Multiply(h2, [0, 5]), [0, 944331445]);
          }
          k1 = [0, 0];
          k2 = [0, 0];
          switch (remainder) {
            case 15:
              k2 = x64Xor(k2, x64LeftShift([0, key.charCodeAt(i + 14)], 48));
            case 14:
              k2 = x64Xor(k2, x64LeftShift([0, key.charCodeAt(i + 13)], 40));
            case 13:
              k2 = x64Xor(k2, x64LeftShift([0, key.charCodeAt(i + 12)], 32));
            case 12:
              k2 = x64Xor(k2, x64LeftShift([0, key.charCodeAt(i + 11)], 24));
            case 11:
              k2 = x64Xor(k2, x64LeftShift([0, key.charCodeAt(i + 10)], 16));
            case 10:
              k2 = x64Xor(k2, x64LeftShift([0, key.charCodeAt(i + 9)], 8));
            case 9:
              k2 = x64Xor(k2, [0, key.charCodeAt(i + 8)]);
              k2 = x64Multiply(k2, c2);
              k2 = x64Rotl(k2, 33);
              k2 = x64Multiply(k2, c1);
              h2 = x64Xor(h2, k2);
            case 8:
              k1 = x64Xor(k1, x64LeftShift([0, key.charCodeAt(i + 7)], 56));
            case 7:
              k1 = x64Xor(k1, x64LeftShift([0, key.charCodeAt(i + 6)], 48));
            case 6:
              k1 = x64Xor(k1, x64LeftShift([0, key.charCodeAt(i + 5)], 40));
            case 5:
              k1 = x64Xor(k1, x64LeftShift([0, key.charCodeAt(i + 4)], 32));
            case 4:
              k1 = x64Xor(k1, x64LeftShift([0, key.charCodeAt(i + 3)], 24));
            case 3:
              k1 = x64Xor(k1, x64LeftShift([0, key.charCodeAt(i + 2)], 16));
            case 2:
              k1 = x64Xor(k1, x64LeftShift([0, key.charCodeAt(i + 1)], 8));
            case 1:
              k1 = x64Xor(k1, [0, key.charCodeAt(i)]);
              k1 = x64Multiply(k1, c1);
              k1 = x64Rotl(k1, 31);
              k1 = x64Multiply(k1, c2);
              h1 = x64Xor(h1, k1);
          }
          h1 = x64Xor(h1, [0, key.length]);
          h2 = x64Xor(h2, [0, key.length]);
          h1 = x64Add(h1, h2);
          h2 = x64Add(h2, h1);
          h1 = x64Fmix(h1);
          h2 = x64Fmix(h2);
          h1 = x64Add(h1, h2);
          h2 = x64Add(h2, h1);
          return ("00000000" + (h1[0] >>> 0).toString(16)).slice(-8) + ("00000000" + (h1[1] >>> 0).toString(16)).slice(-8) + ("00000000" + (h2[0] >>> 0).toString(16)).slice(-8) + ("00000000" + (h2[1] >>> 0).toString(16)).slice(-8);
        };
        var defaultOptions = {
          preprocessor: null,
          audio: {
            timeout: 1e3,
            excludeIOS11: true
          },
          fonts: {
            swfContainerId: "fingerprintjs2",
            swfPath: "flash/compiled/FontList.swf",
            userDefinedFonts: [],
            extendedJsFonts: false
          },
          screen: {
            detectScreenOrientation: true
          },
          plugins: {
            sortPluginsFor: [/palemoon/i],
            excludeIE: false
          },
          extraComponents: [],
          excludes: {
            "enumerateDevices": true,
            "pixelRatio": true,
            "doNotTrack": true,
            "fontsFlash": true,
            "adBlock": true
          },
          NOT_AVAILABLE: "not available",
          ERROR: "error",
          EXCLUDED: "excluded"
        };
        var each = function(obj, iterator) {
          if (Array.prototype.forEach && obj.forEach === Array.prototype.forEach) {
            obj.forEach(iterator);
          } else if (obj.length === +obj.length) {
            for (var i = 0, l = obj.length; i < l; i++) {
              iterator(obj[i], i, obj);
            }
          } else {
            for (var key in obj) {
              if (obj.hasOwnProperty(key)) {
                iterator(obj[key], key, obj);
              }
            }
          }
        };
        var map = function(obj, iterator) {
          var results = [];
          if (obj == null) {
            return results;
          }
          if (Array.prototype.map && obj.map === Array.prototype.map) {
            return obj.map(iterator);
          }
          each(obj, function(value, index, list) {
            results.push(iterator(value, index, list));
          });
          return results;
        };
        var extendSoft = function(target, source) {
          if (source == null) {
            return target;
          }
          var value;
          var key;
          for (key in source) {
            value = source[key];
            if (value != null && !Object.prototype.hasOwnProperty.call(target, key)) {
              target[key] = value;
            }
          }
          return target;
        };
        var enumerateDevicesKey = function(done, options) {
          if (!isEnumerateDevicesSupported()) {
            return done(options.NOT_AVAILABLE);
          }
          navigator.mediaDevices.enumerateDevices().then(function(devices) {
            done(devices.map(function(device) {
              return "id=" + device.deviceId + ";gid=" + device.groupId + ";" + device.kind + ";" + device.label;
            }));
          }).catch(function(error2) {
            done(error2);
          });
        };
        var isEnumerateDevicesSupported = function() {
          return navigator.mediaDevices && navigator.mediaDevices.enumerateDevices;
        };
        var audioKey = function(done, options) {
          var audioOptions = options.audio;
          if (audioOptions.excludeIOS11 && navigator.userAgent.match(/OS 11.+Version\/11.+Safari/)) {
            return done(options.EXCLUDED);
          }
          var AudioContext = window.OfflineAudioContext || window.webkitOfflineAudioContext;
          if (AudioContext == null) {
            return done(options.NOT_AVAILABLE);
          }
          var context = new AudioContext(1, 44100, 44100);
          var oscillator = context.createOscillator();
          oscillator.type = "triangle";
          oscillator.frequency.setValueAtTime(1e4, context.currentTime);
          var compressor = context.createDynamicsCompressor();
          each([
            ["threshold", -50],
            ["knee", 40],
            ["ratio", 12],
            ["reduction", -20],
            ["attack", 0],
            ["release", 0.25]
          ], function(item) {
            if (compressor[item[0]] !== void 0 && typeof compressor[item[0]].setValueAtTime === "function") {
              compressor[item[0]].setValueAtTime(item[1], context.currentTime);
            }
          });
          oscillator.connect(compressor);
          compressor.connect(context.destination);
          oscillator.start(0);
          context.startRendering();
          var audioTimeoutId = setTimeout(function() {
            console.warn('Audio fingerprint timed out. Please report bug at https://github.com/fingerprintjs/fingerprintjs with your user agent: "' + navigator.userAgent + '".');
            context.oncomplete = function() {
            };
            context = null;
            return done("audioTimeout");
          }, audioOptions.timeout);
          context.oncomplete = function(event) {
            var fingerprint;
            try {
              clearTimeout(audioTimeoutId);
              fingerprint = event.renderedBuffer.getChannelData(0).slice(4500, 5e3).reduce(function(acc, val) {
                return acc + Math.abs(val);
              }, 0).toString();
              oscillator.disconnect();
              compressor.disconnect();
            } catch (error2) {
              done(error2);
              return;
            }
            done(fingerprint);
          };
        };
        var UserAgent = function(done) {
          done(navigator.userAgent);
        };
        var webdriver = function(done, options) {
          done(navigator.webdriver == null ? options.NOT_AVAILABLE : navigator.webdriver);
        };
        var languageKey = function(done, options) {
          done(navigator.language || navigator.userLanguage || navigator.browserLanguage || navigator.systemLanguage || options.NOT_AVAILABLE);
        };
        var colorDepthKey = function(done, options) {
          done(window.screen.colorDepth || options.NOT_AVAILABLE);
        };
        var deviceMemoryKey = function(done, options) {
          done(navigator.deviceMemory || options.NOT_AVAILABLE);
        };
        var pixelRatioKey = function(done, options) {
          done(window.devicePixelRatio || options.NOT_AVAILABLE);
        };
        var screenResolutionKey = function(done, options) {
          done(getScreenResolution(options));
        };
        var getScreenResolution = function(options) {
          var resolution = [window.screen.width, window.screen.height];
          if (options.screen.detectScreenOrientation) {
            resolution.sort().reverse();
          }
          return resolution;
        };
        var availableScreenResolutionKey = function(done, options) {
          done(getAvailableScreenResolution(options));
        };
        var getAvailableScreenResolution = function(options) {
          if (window.screen.availWidth && window.screen.availHeight) {
            var available = [window.screen.availHeight, window.screen.availWidth];
            if (options.screen.detectScreenOrientation) {
              available.sort().reverse();
            }
            return available;
          }
          return options.NOT_AVAILABLE;
        };
        var timezoneOffset = function(done) {
          done(new Date().getTimezoneOffset());
        };
        var timezone = function(done, options) {
          if (window.Intl && window.Intl.DateTimeFormat) {
            done(new window.Intl.DateTimeFormat().resolvedOptions().timeZone || options.NOT_AVAILABLE);
            return;
          }
          done(options.NOT_AVAILABLE);
        };
        var sessionStorageKey = function(done, options) {
          done(hasSessionStorage(options));
        };
        var localStorageKey = function(done, options) {
          done(hasLocalStorage(options));
        };
        var indexedDbKey = function(done, options) {
          done(hasIndexedDB(options));
        };
        var addBehaviorKey = function(done) {
          done(!!window.HTMLElement.prototype.addBehavior);
        };
        var openDatabaseKey = function(done) {
          done(!!window.openDatabase);
        };
        var cpuClassKey = function(done, options) {
          done(getNavigatorCpuClass(options));
        };
        var platformKey = function(done, options) {
          done(getNavigatorPlatform(options));
        };
        var doNotTrackKey = function(done, options) {
          done(getDoNotTrack(options));
        };
        var canvasKey = function(done, options) {
          if (isCanvasSupported()) {
            done(getCanvasFp(options));
            return;
          }
          done(options.NOT_AVAILABLE);
        };
        var webglKey = function(done, options) {
          if (isWebGlSupported()) {
            done(getWebglFp());
            return;
          }
          done(options.NOT_AVAILABLE);
        };
        var webglVendorAndRendererKey = function(done) {
          if (isWebGlSupported()) {
            done(getWebglVendorAndRenderer());
            return;
          }
          done();
        };
        var adBlockKey = function(done) {
          done(getAdBlock());
        };
        var hasLiedLanguagesKey = function(done) {
          done(getHasLiedLanguages());
        };
        var hasLiedResolutionKey = function(done) {
          done(getHasLiedResolution());
        };
        var hasLiedOsKey = function(done) {
          done(getHasLiedOs());
        };
        var hasLiedBrowserKey = function(done) {
          done(getHasLiedBrowser());
        };
        var flashFontsKey = function(done, options) {
          if (!hasSwfObjectLoaded()) {
            return done("swf object not loaded");
          }
          if (!hasMinFlashInstalled()) {
            return done("flash not installed");
          }
          if (!options.fonts.swfPath) {
            return done("missing options.fonts.swfPath");
          }
          loadSwfAndDetectFonts(function(fonts) {
            done(fonts);
          }, options);
        };
        var jsFontsKey = function(done, options) {
          var baseFonts = ["monospace", "sans-serif", "serif"];
          var fontList = [
            "Andale Mono",
            "Arial",
            "Arial Black",
            "Arial Hebrew",
            "Arial MT",
            "Arial Narrow",
            "Arial Rounded MT Bold",
            "Arial Unicode MS",
            "Bitstream Vera Sans Mono",
            "Book Antiqua",
            "Bookman Old Style",
            "Calibri",
            "Cambria",
            "Cambria Math",
            "Century",
            "Century Gothic",
            "Century Schoolbook",
            "Comic Sans",
            "Comic Sans MS",
            "Consolas",
            "Courier",
            "Courier New",
            "Geneva",
            "Georgia",
            "Helvetica",
            "Helvetica Neue",
            "Impact",
            "Lucida Bright",
            "Lucida Calligraphy",
            "Lucida Console",
            "Lucida Fax",
            "LUCIDA GRANDE",
            "Lucida Handwriting",
            "Lucida Sans",
            "Lucida Sans Typewriter",
            "Lucida Sans Unicode",
            "Microsoft Sans Serif",
            "Monaco",
            "Monotype Corsiva",
            "MS Gothic",
            "MS Outlook",
            "MS PGothic",
            "MS Reference Sans Serif",
            "MS Sans Serif",
            "MS Serif",
            "MYRIAD",
            "MYRIAD PRO",
            "Palatino",
            "Palatino Linotype",
            "Segoe Print",
            "Segoe Script",
            "Segoe UI",
            "Segoe UI Light",
            "Segoe UI Semibold",
            "Segoe UI Symbol",
            "Tahoma",
            "Times",
            "Times New Roman",
            "Times New Roman PS",
            "Trebuchet MS",
            "Verdana",
            "Wingdings",
            "Wingdings 2",
            "Wingdings 3"
          ];
          if (options.fonts.extendedJsFonts) {
            var extendedFontList = [
              "Abadi MT Condensed Light",
              "Academy Engraved LET",
              "ADOBE CASLON PRO",
              "Adobe Garamond",
              "ADOBE GARAMOND PRO",
              "Agency FB",
              "Aharoni",
              "Albertus Extra Bold",
              "Albertus Medium",
              "Algerian",
              "Amazone BT",
              "American Typewriter",
              "American Typewriter Condensed",
              "AmerType Md BT",
              "Andalus",
              "Angsana New",
              "AngsanaUPC",
              "Antique Olive",
              "Aparajita",
              "Apple Chancery",
              "Apple Color Emoji",
              "Apple SD Gothic Neo",
              "Arabic Typesetting",
              "ARCHER",
              "ARNO PRO",
              "Arrus BT",
              "Aurora Cn BT",
              "AvantGarde Bk BT",
              "AvantGarde Md BT",
              "AVENIR",
              "Ayuthaya",
              "Bandy",
              "Bangla Sangam MN",
              "Bank Gothic",
              "BankGothic Md BT",
              "Baskerville",
              "Baskerville Old Face",
              "Batang",
              "BatangChe",
              "Bauer Bodoni",
              "Bauhaus 93",
              "Bazooka",
              "Bell MT",
              "Bembo",
              "Benguiat Bk BT",
              "Berlin Sans FB",
              "Berlin Sans FB Demi",
              "Bernard MT Condensed",
              "BernhardFashion BT",
              "BernhardMod BT",
              "Big Caslon",
              "BinnerD",
              "Blackadder ITC",
              "BlairMdITC TT",
              "Bodoni 72",
              "Bodoni 72 Oldstyle",
              "Bodoni 72 Smallcaps",
              "Bodoni MT",
              "Bodoni MT Black",
              "Bodoni MT Condensed",
              "Bodoni MT Poster Compressed",
              "Bookshelf Symbol 7",
              "Boulder",
              "Bradley Hand",
              "Bradley Hand ITC",
              "Bremen Bd BT",
              "Britannic Bold",
              "Broadway",
              "Browallia New",
              "BrowalliaUPC",
              "Brush Script MT",
              "Californian FB",
              "Calisto MT",
              "Calligrapher",
              "Candara",
              "CaslonOpnface BT",
              "Castellar",
              "Centaur",
              "Cezanne",
              "CG Omega",
              "CG Times",
              "Chalkboard",
              "Chalkboard SE",
              "Chalkduster",
              "Charlesworth",
              "Charter Bd BT",
              "Charter BT",
              "Chaucer",
              "ChelthmITC Bk BT",
              "Chiller",
              "Clarendon",
              "Clarendon Condensed",
              "CloisterBlack BT",
              "Cochin",
              "Colonna MT",
              "Constantia",
              "Cooper Black",
              "Copperplate",
              "Copperplate Gothic",
              "Copperplate Gothic Bold",
              "Copperplate Gothic Light",
              "CopperplGoth Bd BT",
              "Corbel",
              "Cordia New",
              "CordiaUPC",
              "Cornerstone",
              "Coronet",
              "Cuckoo",
              "Curlz MT",
              "DaunPenh",
              "Dauphin",
              "David",
              "DB LCD Temp",
              "DELICIOUS",
              "Denmark",
              "DFKai-SB",
              "Didot",
              "DilleniaUPC",
              "DIN",
              "DokChampa",
              "Dotum",
              "DotumChe",
              "Ebrima",
              "Edwardian Script ITC",
              "Elephant",
              "English 111 Vivace BT",
              "Engravers MT",
              "EngraversGothic BT",
              "Eras Bold ITC",
              "Eras Demi ITC",
              "Eras Light ITC",
              "Eras Medium ITC",
              "EucrosiaUPC",
              "Euphemia",
              "Euphemia UCAS",
              "EUROSTILE",
              "Exotc350 Bd BT",
              "FangSong",
              "Felix Titling",
              "Fixedsys",
              "FONTIN",
              "Footlight MT Light",
              "Forte",
              "FrankRuehl",
              "Fransiscan",
              "Freefrm721 Blk BT",
              "FreesiaUPC",
              "Freestyle Script",
              "French Script MT",
              "FrnkGothITC Bk BT",
              "Fruitger",
              "FRUTIGER",
              "Futura",
              "Futura Bk BT",
              "Futura Lt BT",
              "Futura Md BT",
              "Futura ZBlk BT",
              "FuturaBlack BT",
              "Gabriola",
              "Galliard BT",
              "Gautami",
              "Geeza Pro",
              "Geometr231 BT",
              "Geometr231 Hv BT",
              "Geometr231 Lt BT",
              "GeoSlab 703 Lt BT",
              "GeoSlab 703 XBd BT",
              "Gigi",
              "Gill Sans",
              "Gill Sans MT",
              "Gill Sans MT Condensed",
              "Gill Sans MT Ext Condensed Bold",
              "Gill Sans Ultra Bold",
              "Gill Sans Ultra Bold Condensed",
              "Gisha",
              "Gloucester MT Extra Condensed",
              "GOTHAM",
              "GOTHAM BOLD",
              "Goudy Old Style",
              "Goudy Stout",
              "GoudyHandtooled BT",
              "GoudyOLSt BT",
              "Gujarati Sangam MN",
              "Gulim",
              "GulimChe",
              "Gungsuh",
              "GungsuhChe",
              "Gurmukhi MN",
              "Haettenschweiler",
              "Harlow Solid Italic",
              "Harrington",
              "Heather",
              "Heiti SC",
              "Heiti TC",
              "HELV",
              "Herald",
              "High Tower Text",
              "Hiragino Kaku Gothic ProN",
              "Hiragino Mincho ProN",
              "Hoefler Text",
              "Humanst 521 Cn BT",
              "Humanst521 BT",
              "Humanst521 Lt BT",
              "Imprint MT Shadow",
              "Incised901 Bd BT",
              "Incised901 BT",
              "Incised901 Lt BT",
              "INCONSOLATA",
              "Informal Roman",
              "Informal011 BT",
              "INTERSTATE",
              "IrisUPC",
              "Iskoola Pota",
              "JasmineUPC",
              "Jazz LET",
              "Jenson",
              "Jester",
              "Jokerman",
              "Juice ITC",
              "Kabel Bk BT",
              "Kabel Ult BT",
              "Kailasa",
              "KaiTi",
              "Kalinga",
              "Kannada Sangam MN",
              "Kartika",
              "Kaufmann Bd BT",
              "Kaufmann BT",
              "Khmer UI",
              "KodchiangUPC",
              "Kokila",
              "Korinna BT",
              "Kristen ITC",
              "Krungthep",
              "Kunstler Script",
              "Lao UI",
              "Latha",
              "Leelawadee",
              "Letter Gothic",
              "Levenim MT",
              "LilyUPC",
              "Lithograph",
              "Lithograph Light",
              "Long Island",
              "Lydian BT",
              "Magneto",
              "Maiandra GD",
              "Malayalam Sangam MN",
              "Malgun Gothic",
              "Mangal",
              "Marigold",
              "Marion",
              "Marker Felt",
              "Market",
              "Marlett",
              "Matisse ITC",
              "Matura MT Script Capitals",
              "Meiryo",
              "Meiryo UI",
              "Microsoft Himalaya",
              "Microsoft JhengHei",
              "Microsoft New Tai Lue",
              "Microsoft PhagsPa",
              "Microsoft Tai Le",
              "Microsoft Uighur",
              "Microsoft YaHei",
              "Microsoft Yi Baiti",
              "MingLiU",
              "MingLiU_HKSCS",
              "MingLiU_HKSCS-ExtB",
              "MingLiU-ExtB",
              "Minion",
              "Minion Pro",
              "Miriam",
              "Miriam Fixed",
              "Mistral",
              "Modern",
              "Modern No. 20",
              "Mona Lisa Solid ITC TT",
              "Mongolian Baiti",
              "MONO",
              "MoolBoran",
              "Mrs Eaves",
              "MS LineDraw",
              "MS Mincho",
              "MS PMincho",
              "MS Reference Specialty",
              "MS UI Gothic",
              "MT Extra",
              "MUSEO",
              "MV Boli",
              "Nadeem",
              "Narkisim",
              "NEVIS",
              "News Gothic",
              "News GothicMT",
              "NewsGoth BT",
              "Niagara Engraved",
              "Niagara Solid",
              "Noteworthy",
              "NSimSun",
              "Nyala",
              "OCR A Extended",
              "Old Century",
              "Old English Text MT",
              "Onyx",
              "Onyx BT",
              "OPTIMA",
              "Oriya Sangam MN",
              "OSAKA",
              "OzHandicraft BT",
              "Palace Script MT",
              "Papyrus",
              "Parchment",
              "Party LET",
              "Pegasus",
              "Perpetua",
              "Perpetua Titling MT",
              "PetitaBold",
              "Pickwick",
              "Plantagenet Cherokee",
              "Playbill",
              "PMingLiU",
              "PMingLiU-ExtB",
              "Poor Richard",
              "Poster",
              "PosterBodoni BT",
              "PRINCETOWN LET",
              "Pristina",
              "PTBarnum BT",
              "Pythagoras",
              "Raavi",
              "Rage Italic",
              "Ravie",
              "Ribbon131 Bd BT",
              "Rockwell",
              "Rockwell Condensed",
              "Rockwell Extra Bold",
              "Rod",
              "Roman",
              "Sakkal Majalla",
              "Santa Fe LET",
              "Savoye LET",
              "Sceptre",
              "Script",
              "Script MT Bold",
              "SCRIPTINA",
              "Serifa",
              "Serifa BT",
              "Serifa Th BT",
              "ShelleyVolante BT",
              "Sherwood",
              "Shonar Bangla",
              "Showcard Gothic",
              "Shruti",
              "Signboard",
              "SILKSCREEN",
              "SimHei",
              "Simplified Arabic",
              "Simplified Arabic Fixed",
              "SimSun",
              "SimSun-ExtB",
              "Sinhala Sangam MN",
              "Sketch Rockwell",
              "Skia",
              "Small Fonts",
              "Snap ITC",
              "Snell Roundhand",
              "Socket",
              "Souvenir Lt BT",
              "Staccato222 BT",
              "Steamer",
              "Stencil",
              "Storybook",
              "Styllo",
              "Subway",
              "Swis721 BlkEx BT",
              "Swiss911 XCm BT",
              "Sylfaen",
              "Synchro LET",
              "System",
              "Tamil Sangam MN",
              "Technical",
              "Teletype",
              "Telugu Sangam MN",
              "Tempus Sans ITC",
              "Terminal",
              "Thonburi",
              "Traditional Arabic",
              "Trajan",
              "TRAJAN PRO",
              "Tristan",
              "Tubular",
              "Tunga",
              "Tw Cen MT",
              "Tw Cen MT Condensed",
              "Tw Cen MT Condensed Extra Bold",
              "TypoUpright BT",
              "Unicorn",
              "Univers",
              "Univers CE 55 Medium",
              "Univers Condensed",
              "Utsaah",
              "Vagabond",
              "Vani",
              "Vijaya",
              "Viner Hand ITC",
              "VisualUI",
              "Vivaldi",
              "Vladimir Script",
              "Vrinda",
              "Westminster",
              "WHITNEY",
              "Wide Latin",
              "ZapfEllipt BT",
              "ZapfHumnst BT",
              "ZapfHumnst Dm BT",
              "Zapfino",
              "Zurich BlkEx BT",
              "Zurich Ex BT",
              "ZWAdobeF"
            ];
            fontList = fontList.concat(extendedFontList);
          }
          fontList = fontList.concat(options.fonts.userDefinedFonts);
          fontList = fontList.filter(function(font, position) {
            return fontList.indexOf(font) === position;
          });
          var testString = "mmmmmmmmmmlli";
          var testSize = "72px";
          var h = document.getElementsByTagName("body")[0];
          var baseFontsDiv = document.createElement("div");
          var fontsDiv = document.createElement("div");
          var defaultWidth = {};
          var defaultHeight = {};
          var createSpan = function() {
            var s = document.createElement("span");
            s.style.position = "absolute";
            s.style.left = "-9999px";
            s.style.fontSize = testSize;
            s.style.fontStyle = "normal";
            s.style.fontWeight = "normal";
            s.style.letterSpacing = "normal";
            s.style.lineBreak = "auto";
            s.style.lineHeight = "normal";
            s.style.textTransform = "none";
            s.style.textAlign = "left";
            s.style.textDecoration = "none";
            s.style.textShadow = "none";
            s.style.whiteSpace = "normal";
            s.style.wordBreak = "normal";
            s.style.wordSpacing = "normal";
            s.innerHTML = testString;
            return s;
          };
          var createSpanWithFonts = function(fontToDetect, baseFont) {
            var s = createSpan();
            s.style.fontFamily = "'" + fontToDetect + "'," + baseFont;
            return s;
          };
          var initializeBaseFontsSpans = function() {
            var spans = [];
            for (var index2 = 0, length2 = baseFonts.length; index2 < length2; index2++) {
              var s = createSpan();
              s.style.fontFamily = baseFonts[index2];
              baseFontsDiv.appendChild(s);
              spans.push(s);
            }
            return spans;
          };
          var initializeFontsSpans = function() {
            var spans = {};
            for (var i2 = 0, l2 = fontList.length; i2 < l2; i2++) {
              var fontSpans = [];
              for (var j = 0, numDefaultFonts = baseFonts.length; j < numDefaultFonts; j++) {
                var s = createSpanWithFonts(fontList[i2], baseFonts[j]);
                fontsDiv.appendChild(s);
                fontSpans.push(s);
              }
              spans[fontList[i2]] = fontSpans;
            }
            return spans;
          };
          var isFontAvailable = function(fontSpans) {
            var detected = false;
            for (var i2 = 0; i2 < baseFonts.length; i2++) {
              detected = fontSpans[i2].offsetWidth !== defaultWidth[baseFonts[i2]] || fontSpans[i2].offsetHeight !== defaultHeight[baseFonts[i2]];
              if (detected) {
                return detected;
              }
            }
            return detected;
          };
          var baseFontsSpans = initializeBaseFontsSpans();
          h.appendChild(baseFontsDiv);
          for (var index = 0, length = baseFonts.length; index < length; index++) {
            defaultWidth[baseFonts[index]] = baseFontsSpans[index].offsetWidth;
            defaultHeight[baseFonts[index]] = baseFontsSpans[index].offsetHeight;
          }
          var fontsSpans = initializeFontsSpans();
          h.appendChild(fontsDiv);
          var available = [];
          for (var i = 0, l = fontList.length; i < l; i++) {
            if (isFontAvailable(fontsSpans[fontList[i]])) {
              available.push(fontList[i]);
            }
          }
          h.removeChild(fontsDiv);
          h.removeChild(baseFontsDiv);
          done(available);
        };
        var pluginsComponent = function(done, options) {
          if (isIE()) {
            if (!options.plugins.excludeIE) {
              done(getIEPlugins(options));
            } else {
              done(options.EXCLUDED);
            }
          } else {
            done(getRegularPlugins(options));
          }
        };
        var getRegularPlugins = function(options) {
          if (navigator.plugins == null) {
            return options.NOT_AVAILABLE;
          }
          var plugins = [];
          for (var i = 0, l = navigator.plugins.length; i < l; i++) {
            if (navigator.plugins[i]) {
              plugins.push(navigator.plugins[i]);
            }
          }
          if (pluginsShouldBeSorted(options)) {
            plugins = plugins.sort(function(a, b) {
              if (a.name > b.name) {
                return 1;
              }
              if (a.name < b.name) {
                return -1;
              }
              return 0;
            });
          }
          return map(plugins, function(p) {
            var mimeTypes = map(p, function(mt) {
              return [mt.type, mt.suffixes];
            });
            return [p.name, p.description, mimeTypes];
          });
        };
        var getIEPlugins = function(options) {
          var result = [];
          if (Object.getOwnPropertyDescriptor && Object.getOwnPropertyDescriptor(window, "ActiveXObject") || "ActiveXObject" in window) {
            var names = [
              "AcroPDF.PDF",
              "Adodb.Stream",
              "AgControl.AgControl",
              "DevalVRXCtrl.DevalVRXCtrl.1",
              "MacromediaFlashPaper.MacromediaFlashPaper",
              "Msxml2.DOMDocument",
              "Msxml2.XMLHTTP",
              "PDF.PdfCtrl",
              "QuickTime.QuickTime",
              "QuickTimeCheckObject.QuickTimeCheck.1",
              "RealPlayer",
              "RealPlayer.RealPlayer(tm) ActiveX Control (32-bit)",
              "RealVideo.RealVideo(tm) ActiveX Control (32-bit)",
              "Scripting.Dictionary",
              "SWCtl.SWCtl",
              "Shell.UIHelper",
              "ShockwaveFlash.ShockwaveFlash",
              "Skype.Detection",
              "TDCCtl.TDCCtl",
              "WMPlayer.OCX",
              "rmocx.RealPlayer G2 Control",
              "rmocx.RealPlayer G2 Control.1"
            ];
            result = map(names, function(name) {
              try {
                new window.ActiveXObject(name);
                return name;
              } catch (e2) {
                return options.ERROR;
              }
            });
          } else {
            result.push(options.NOT_AVAILABLE);
          }
          if (navigator.plugins) {
            result = result.concat(getRegularPlugins(options));
          }
          return result;
        };
        var pluginsShouldBeSorted = function(options) {
          var should = false;
          for (var i = 0, l = options.plugins.sortPluginsFor.length; i < l; i++) {
            var re = options.plugins.sortPluginsFor[i];
            if (navigator.userAgent.match(re)) {
              should = true;
              break;
            }
          }
          return should;
        };
        var touchSupportKey = function(done) {
          done(getTouchSupport());
        };
        var hardwareConcurrencyKey = function(done, options) {
          done(getHardwareConcurrency(options));
        };
        var hasSessionStorage = function(options) {
          try {
            return !!window.sessionStorage;
          } catch (e2) {
            return options.ERROR;
          }
        };
        var hasLocalStorage = function(options) {
          try {
            return !!window.localStorage;
          } catch (e2) {
            return options.ERROR;
          }
        };
        var hasIndexedDB = function(options) {
          if (isIEOrOldEdge()) {
            return options.EXCLUDED;
          }
          try {
            return !!window.indexedDB;
          } catch (e2) {
            return options.ERROR;
          }
        };
        var getHardwareConcurrency = function(options) {
          if (navigator.hardwareConcurrency) {
            return navigator.hardwareConcurrency;
          }
          return options.NOT_AVAILABLE;
        };
        var getNavigatorCpuClass = function(options) {
          return navigator.cpuClass || options.NOT_AVAILABLE;
        };
        var getNavigatorPlatform = function(options) {
          if (navigator.platform) {
            return navigator.platform;
          } else {
            return options.NOT_AVAILABLE;
          }
        };
        var getDoNotTrack = function(options) {
          if (navigator.doNotTrack) {
            return navigator.doNotTrack;
          } else if (navigator.msDoNotTrack) {
            return navigator.msDoNotTrack;
          } else if (window.doNotTrack) {
            return window.doNotTrack;
          } else {
            return options.NOT_AVAILABLE;
          }
        };
        var getTouchSupport = function() {
          var maxTouchPoints = 0;
          var touchEvent;
          if (typeof navigator.maxTouchPoints !== "undefined") {
            maxTouchPoints = navigator.maxTouchPoints;
          } else if (typeof navigator.msMaxTouchPoints !== "undefined") {
            maxTouchPoints = navigator.msMaxTouchPoints;
          }
          try {
            document.createEvent("TouchEvent");
            touchEvent = true;
          } catch (_) {
            touchEvent = false;
          }
          var touchStart = "ontouchstart" in window;
          return [maxTouchPoints, touchEvent, touchStart];
        };
        var getCanvasFp = function(options) {
          var result = [];
          var canvas = document.createElement("canvas");
          canvas.width = 2e3;
          canvas.height = 200;
          canvas.style.display = "inline";
          var ctx = canvas.getContext("2d");
          ctx.rect(0, 0, 10, 10);
          ctx.rect(2, 2, 6, 6);
          result.push("canvas winding:" + (ctx.isPointInPath(5, 5, "evenodd") === false ? "yes" : "no"));
          ctx.textBaseline = "alphabetic";
          ctx.fillStyle = "#f60";
          ctx.fillRect(125, 1, 62, 20);
          ctx.fillStyle = "#069";
          if (options.dontUseFakeFontInCanvas) {
            ctx.font = "11pt Arial";
          } else {
            ctx.font = "11pt no-real-font-123";
          }
          ctx.fillText("Cwm fjordbank glyphs vext quiz, \u{1F603}", 2, 15);
          ctx.fillStyle = "rgba(102, 204, 0, 0.2)";
          ctx.font = "18pt Arial";
          ctx.fillText("Cwm fjordbank glyphs vext quiz, \u{1F603}", 4, 45);
          ctx.globalCompositeOperation = "multiply";
          ctx.fillStyle = "rgb(255,0,255)";
          ctx.beginPath();
          ctx.arc(50, 50, 50, 0, Math.PI * 2, true);
          ctx.closePath();
          ctx.fill();
          ctx.fillStyle = "rgb(0,255,255)";
          ctx.beginPath();
          ctx.arc(100, 50, 50, 0, Math.PI * 2, true);
          ctx.closePath();
          ctx.fill();
          ctx.fillStyle = "rgb(255,255,0)";
          ctx.beginPath();
          ctx.arc(75, 100, 50, 0, Math.PI * 2, true);
          ctx.closePath();
          ctx.fill();
          ctx.fillStyle = "rgb(255,0,255)";
          ctx.arc(75, 75, 75, 0, Math.PI * 2, true);
          ctx.arc(75, 75, 25, 0, Math.PI * 2, true);
          ctx.fill("evenodd");
          if (canvas.toDataURL) {
            result.push("canvas fp:" + canvas.toDataURL());
          }
          return result;
        };
        var getWebglFp = function() {
          var gl;
          var fa2s = function(fa) {
            gl.clearColor(0, 0, 0, 1);
            gl.enable(gl.DEPTH_TEST);
            gl.depthFunc(gl.LEQUAL);
            gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
            return "[" + fa[0] + ", " + fa[1] + "]";
          };
          var maxAnisotropy = function(gl2) {
            var ext = gl2.getExtension("EXT_texture_filter_anisotropic") || gl2.getExtension("WEBKIT_EXT_texture_filter_anisotropic") || gl2.getExtension("MOZ_EXT_texture_filter_anisotropic");
            if (ext) {
              var anisotropy = gl2.getParameter(ext.MAX_TEXTURE_MAX_ANISOTROPY_EXT);
              if (anisotropy === 0) {
                anisotropy = 2;
              }
              return anisotropy;
            } else {
              return null;
            }
          };
          gl = getWebglCanvas();
          if (!gl) {
            return null;
          }
          var result = [];
          var vShaderTemplate = "attribute vec2 attrVertex;varying vec2 varyinTexCoordinate;uniform vec2 uniformOffset;void main(){varyinTexCoordinate=attrVertex+uniformOffset;gl_Position=vec4(attrVertex,0,1);}";
          var fShaderTemplate = "precision mediump float;varying vec2 varyinTexCoordinate;void main() {gl_FragColor=vec4(varyinTexCoordinate,0,1);}";
          var vertexPosBuffer = gl.createBuffer();
          gl.bindBuffer(gl.ARRAY_BUFFER, vertexPosBuffer);
          var vertices = new Float32Array([-0.2, -0.9, 0, 0.4, -0.26, 0, 0, 0.732134444, 0]);
          gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);
          vertexPosBuffer.itemSize = 3;
          vertexPosBuffer.numItems = 3;
          var program = gl.createProgram();
          var vshader = gl.createShader(gl.VERTEX_SHADER);
          gl.shaderSource(vshader, vShaderTemplate);
          gl.compileShader(vshader);
          var fshader = gl.createShader(gl.FRAGMENT_SHADER);
          gl.shaderSource(fshader, fShaderTemplate);
          gl.compileShader(fshader);
          gl.attachShader(program, vshader);
          gl.attachShader(program, fshader);
          gl.linkProgram(program);
          gl.useProgram(program);
          program.vertexPosAttrib = gl.getAttribLocation(program, "attrVertex");
          program.offsetUniform = gl.getUniformLocation(program, "uniformOffset");
          gl.enableVertexAttribArray(program.vertexPosArray);
          gl.vertexAttribPointer(program.vertexPosAttrib, vertexPosBuffer.itemSize, gl.FLOAT, false, 0, 0);
          gl.uniform2f(program.offsetUniform, 1, 1);
          gl.drawArrays(gl.TRIANGLE_STRIP, 0, vertexPosBuffer.numItems);
          try {
            result.push(gl.canvas.toDataURL());
          } catch (e2) {
          }
          result.push("extensions:" + (gl.getSupportedExtensions() || []).join(";"));
          result.push("webgl aliased line width range:" + fa2s(gl.getParameter(gl.ALIASED_LINE_WIDTH_RANGE)));
          result.push("webgl aliased point size range:" + fa2s(gl.getParameter(gl.ALIASED_POINT_SIZE_RANGE)));
          result.push("webgl alpha bits:" + gl.getParameter(gl.ALPHA_BITS));
          result.push("webgl antialiasing:" + (gl.getContextAttributes().antialias ? "yes" : "no"));
          result.push("webgl blue bits:" + gl.getParameter(gl.BLUE_BITS));
          result.push("webgl depth bits:" + gl.getParameter(gl.DEPTH_BITS));
          result.push("webgl green bits:" + gl.getParameter(gl.GREEN_BITS));
          result.push("webgl max anisotropy:" + maxAnisotropy(gl));
          result.push("webgl max combined texture image units:" + gl.getParameter(gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS));
          result.push("webgl max cube map texture size:" + gl.getParameter(gl.MAX_CUBE_MAP_TEXTURE_SIZE));
          result.push("webgl max fragment uniform vectors:" + gl.getParameter(gl.MAX_FRAGMENT_UNIFORM_VECTORS));
          result.push("webgl max render buffer size:" + gl.getParameter(gl.MAX_RENDERBUFFER_SIZE));
          result.push("webgl max texture image units:" + gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS));
          result.push("webgl max texture size:" + gl.getParameter(gl.MAX_TEXTURE_SIZE));
          result.push("webgl max varying vectors:" + gl.getParameter(gl.MAX_VARYING_VECTORS));
          result.push("webgl max vertex attribs:" + gl.getParameter(gl.MAX_VERTEX_ATTRIBS));
          result.push("webgl max vertex texture image units:" + gl.getParameter(gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS));
          result.push("webgl max vertex uniform vectors:" + gl.getParameter(gl.MAX_VERTEX_UNIFORM_VECTORS));
          result.push("webgl max viewport dims:" + fa2s(gl.getParameter(gl.MAX_VIEWPORT_DIMS)));
          result.push("webgl red bits:" + gl.getParameter(gl.RED_BITS));
          result.push("webgl renderer:" + gl.getParameter(gl.RENDERER));
          result.push("webgl shading language version:" + gl.getParameter(gl.SHADING_LANGUAGE_VERSION));
          result.push("webgl stencil bits:" + gl.getParameter(gl.STENCIL_BITS));
          result.push("webgl vendor:" + gl.getParameter(gl.VENDOR));
          result.push("webgl version:" + gl.getParameter(gl.VERSION));
          try {
            var extensionDebugRendererInfo = gl.getExtension("WEBGL_debug_renderer_info");
            if (extensionDebugRendererInfo) {
              result.push("webgl unmasked vendor:" + gl.getParameter(extensionDebugRendererInfo.UNMASKED_VENDOR_WEBGL));
              result.push("webgl unmasked renderer:" + gl.getParameter(extensionDebugRendererInfo.UNMASKED_RENDERER_WEBGL));
            }
          } catch (e2) {
          }
          if (!gl.getShaderPrecisionFormat) {
            loseWebglContext(gl);
            return result;
          }
          each(["FLOAT", "INT"], function(numType) {
            each(["VERTEX", "FRAGMENT"], function(shader) {
              each(["HIGH", "MEDIUM", "LOW"], function(numSize) {
                each(["precision", "rangeMin", "rangeMax"], function(key) {
                  var format = gl.getShaderPrecisionFormat(gl[shader + "_SHADER"], gl[numSize + "_" + numType])[key];
                  if (key !== "precision") {
                    key = "precision " + key;
                  }
                  var line = ["webgl ", shader.toLowerCase(), " shader ", numSize.toLowerCase(), " ", numType.toLowerCase(), " ", key, ":", format].join("");
                  result.push(line);
                });
              });
            });
          });
          loseWebglContext(gl);
          return result;
        };
        var getWebglVendorAndRenderer = function() {
          try {
            var glContext = getWebglCanvas();
            var extensionDebugRendererInfo = glContext.getExtension("WEBGL_debug_renderer_info");
            var params = glContext.getParameter(extensionDebugRendererInfo.UNMASKED_VENDOR_WEBGL) + "~" + glContext.getParameter(extensionDebugRendererInfo.UNMASKED_RENDERER_WEBGL);
            loseWebglContext(glContext);
            return params;
          } catch (e2) {
            return null;
          }
        };
        var getAdBlock = function() {
          var ads = document.createElement("div");
          ads.innerHTML = "&nbsp;";
          ads.className = "adsbox";
          var result = false;
          try {
            document.body.appendChild(ads);
            result = document.getElementsByClassName("adsbox")[0].offsetHeight === 0;
            document.body.removeChild(ads);
          } catch (e2) {
            result = false;
          }
          return result;
        };
        var getHasLiedLanguages = function() {
          if (typeof navigator.languages !== "undefined") {
            try {
              var firstLanguages = navigator.languages[0].substr(0, 2);
              if (firstLanguages !== navigator.language.substr(0, 2)) {
                return true;
              }
            } catch (err) {
              return true;
            }
          }
          return false;
        };
        var getHasLiedResolution = function() {
          return window.screen.width < window.screen.availWidth || window.screen.height < window.screen.availHeight;
        };
        var getHasLiedOs = function() {
          var userAgent = navigator.userAgent.toLowerCase();
          var oscpu = navigator.oscpu;
          var platform = navigator.platform.toLowerCase();
          var os;
          if (userAgent.indexOf("windows phone") >= 0) {
            os = "Windows Phone";
          } else if (userAgent.indexOf("windows") >= 0 || userAgent.indexOf("win16") >= 0 || userAgent.indexOf("win32") >= 0 || userAgent.indexOf("win64") >= 0 || userAgent.indexOf("win95") >= 0 || userAgent.indexOf("win98") >= 0 || userAgent.indexOf("winnt") >= 0 || userAgent.indexOf("wow64") >= 0) {
            os = "Windows";
          } else if (userAgent.indexOf("android") >= 0) {
            os = "Android";
          } else if (userAgent.indexOf("linux") >= 0 || userAgent.indexOf("cros") >= 0 || userAgent.indexOf("x11") >= 0) {
            os = "Linux";
          } else if (userAgent.indexOf("iphone") >= 0 || userAgent.indexOf("ipad") >= 0 || userAgent.indexOf("ipod") >= 0 || userAgent.indexOf("crios") >= 0 || userAgent.indexOf("fxios") >= 0) {
            os = "iOS";
          } else if (userAgent.indexOf("macintosh") >= 0 || userAgent.indexOf("mac_powerpc)") >= 0) {
            os = "Mac";
          } else {
            os = "Other";
          }
          var mobileDevice = "ontouchstart" in window || navigator.maxTouchPoints > 0 || navigator.msMaxTouchPoints > 0;
          if (mobileDevice && os !== "Windows" && os !== "Windows Phone" && os !== "Android" && os !== "iOS" && os !== "Other" && userAgent.indexOf("cros") === -1) {
            return true;
          }
          if (typeof oscpu !== "undefined") {
            oscpu = oscpu.toLowerCase();
            if (oscpu.indexOf("win") >= 0 && os !== "Windows" && os !== "Windows Phone") {
              return true;
            } else if (oscpu.indexOf("linux") >= 0 && os !== "Linux" && os !== "Android") {
              return true;
            } else if (oscpu.indexOf("mac") >= 0 && os !== "Mac" && os !== "iOS") {
              return true;
            } else if ((oscpu.indexOf("win") === -1 && oscpu.indexOf("linux") === -1 && oscpu.indexOf("mac") === -1) !== (os === "Other")) {
              return true;
            }
          }
          if (platform.indexOf("win") >= 0 && os !== "Windows" && os !== "Windows Phone") {
            return true;
          } else if ((platform.indexOf("linux") >= 0 || platform.indexOf("android") >= 0 || platform.indexOf("pike") >= 0) && os !== "Linux" && os !== "Android") {
            return true;
          } else if ((platform.indexOf("mac") >= 0 || platform.indexOf("ipad") >= 0 || platform.indexOf("ipod") >= 0 || platform.indexOf("iphone") >= 0) && os !== "Mac" && os !== "iOS") {
            return true;
          } else if (platform.indexOf("arm") >= 0 && os === "Windows Phone") {
            return false;
          } else if (platform.indexOf("pike") >= 0 && userAgent.indexOf("opera mini") >= 0) {
            return false;
          } else {
            var platformIsOther = platform.indexOf("win") < 0 && platform.indexOf("linux") < 0 && platform.indexOf("mac") < 0 && platform.indexOf("iphone") < 0 && platform.indexOf("ipad") < 0 && platform.indexOf("ipod") < 0;
            if (platformIsOther !== (os === "Other")) {
              return true;
            }
          }
          return typeof navigator.plugins === "undefined" && os !== "Windows" && os !== "Windows Phone";
        };
        var getHasLiedBrowser = function() {
          var userAgent = navigator.userAgent.toLowerCase();
          var productSub = navigator.productSub;
          var browser;
          if (userAgent.indexOf("edge/") >= 0 || userAgent.indexOf("iemobile/") >= 0) {
            return false;
          } else if (userAgent.indexOf("opera mini") >= 0) {
            return false;
          } else if (userAgent.indexOf("firefox/") >= 0) {
            browser = "Firefox";
          } else if (userAgent.indexOf("opera/") >= 0 || userAgent.indexOf(" opr/") >= 0) {
            browser = "Opera";
          } else if (userAgent.indexOf("chrome/") >= 0) {
            browser = "Chrome";
          } else if (userAgent.indexOf("safari/") >= 0) {
            if (userAgent.indexOf("android 1.") >= 0 || userAgent.indexOf("android 2.") >= 0 || userAgent.indexOf("android 3.") >= 0 || userAgent.indexOf("android 4.") >= 0) {
              browser = "AOSP";
            } else {
              browser = "Safari";
            }
          } else if (userAgent.indexOf("trident/") >= 0) {
            browser = "Internet Explorer";
          } else {
            browser = "Other";
          }
          if ((browser === "Chrome" || browser === "Safari" || browser === "Opera") && productSub !== "20030107") {
            return true;
          }
          var tempRes = eval.toString().length;
          if (tempRes === 37 && browser !== "Safari" && browser !== "Firefox" && browser !== "Other") {
            return true;
          } else if (tempRes === 39 && browser !== "Internet Explorer" && browser !== "Other") {
            return true;
          } else if (tempRes === 33 && browser !== "Chrome" && browser !== "AOSP" && browser !== "Opera" && browser !== "Other") {
            return true;
          }
          var errFirefox;
          try {
            throw "a";
          } catch (err) {
            try {
              err.toSource();
              errFirefox = true;
            } catch (errOfErr) {
              errFirefox = false;
            }
          }
          return errFirefox && browser !== "Firefox" && browser !== "Other";
        };
        var isCanvasSupported = function() {
          var elem = document.createElement("canvas");
          return !!(elem.getContext && elem.getContext("2d"));
        };
        var isWebGlSupported = function() {
          if (!isCanvasSupported()) {
            return false;
          }
          var glContext = getWebglCanvas();
          var isSupported = !!window.WebGLRenderingContext && !!glContext;
          loseWebglContext(glContext);
          return isSupported;
        };
        var isIE = function() {
          if (navigator.appName === "Microsoft Internet Explorer") {
            return true;
          } else if (navigator.appName === "Netscape" && /Trident/.test(navigator.userAgent)) {
            return true;
          }
          return false;
        };
        var isIEOrOldEdge = function() {
          return ("msWriteProfilerMark" in window) + ("msLaunchUri" in navigator) + ("msSaveBlob" in navigator) >= 2;
        };
        var hasSwfObjectLoaded = function() {
          return typeof window.swfobject !== "undefined";
        };
        var hasMinFlashInstalled = function() {
          return window.swfobject.hasFlashPlayerVersion("9.0.0");
        };
        var addFlashDivNode = function(options) {
          var node = document.createElement("div");
          node.setAttribute("id", options.fonts.swfContainerId);
          document.body.appendChild(node);
        };
        var loadSwfAndDetectFonts = function(done, options) {
          var hiddenCallback = "___fp_swf_loaded";
          window[hiddenCallback] = function(fonts) {
            done(fonts);
          };
          var id = options.fonts.swfContainerId;
          addFlashDivNode();
          var flashvars = { onReady: hiddenCallback };
          var flashparams = { allowScriptAccess: "always", menu: "false" };
          window.swfobject.embedSWF(options.fonts.swfPath, id, "1", "1", "9.0.0", false, flashvars, flashparams, {});
        };
        var getWebglCanvas = function() {
          var canvas = document.createElement("canvas");
          var gl = null;
          try {
            gl = canvas.getContext("webgl") || canvas.getContext("experimental-webgl");
          } catch (e2) {
          }
          if (!gl) {
            gl = null;
          }
          return gl;
        };
        var loseWebglContext = function(context) {
          var loseContextExtension = context.getExtension("WEBGL_lose_context");
          if (loseContextExtension != null) {
            loseContextExtension.loseContext();
          }
        };
        var components = [
          { key: "userAgent", getData: UserAgent },
          { key: "webdriver", getData: webdriver },
          { key: "language", getData: languageKey },
          { key: "colorDepth", getData: colorDepthKey },
          { key: "deviceMemory", getData: deviceMemoryKey },
          { key: "pixelRatio", getData: pixelRatioKey },
          { key: "hardwareConcurrency", getData: hardwareConcurrencyKey },
          { key: "screenResolution", getData: screenResolutionKey },
          { key: "availableScreenResolution", getData: availableScreenResolutionKey },
          { key: "timezoneOffset", getData: timezoneOffset },
          { key: "timezone", getData: timezone },
          { key: "sessionStorage", getData: sessionStorageKey },
          { key: "localStorage", getData: localStorageKey },
          { key: "indexedDb", getData: indexedDbKey },
          { key: "addBehavior", getData: addBehaviorKey },
          { key: "openDatabase", getData: openDatabaseKey },
          { key: "cpuClass", getData: cpuClassKey },
          { key: "platform", getData: platformKey },
          { key: "doNotTrack", getData: doNotTrackKey },
          { key: "plugins", getData: pluginsComponent },
          { key: "canvas", getData: canvasKey },
          { key: "webgl", getData: webglKey },
          { key: "webglVendorAndRenderer", getData: webglVendorAndRendererKey },
          { key: "adBlock", getData: adBlockKey },
          { key: "hasLiedLanguages", getData: hasLiedLanguagesKey },
          { key: "hasLiedResolution", getData: hasLiedResolutionKey },
          { key: "hasLiedOs", getData: hasLiedOsKey },
          { key: "hasLiedBrowser", getData: hasLiedBrowserKey },
          { key: "touchSupport", getData: touchSupportKey },
          { key: "fonts", getData: jsFontsKey, pauseBefore: true },
          { key: "fontsFlash", getData: flashFontsKey, pauseBefore: true },
          { key: "audio", getData: audioKey },
          { key: "enumerateDevices", getData: enumerateDevicesKey }
        ];
        var Fingerprint2 = function(options) {
          throw new Error("'new Fingerprint()' is deprecated, see https://github.com/fingerprintjs/fingerprintjs#upgrade-guide-from-182-to-200");
        };
        Fingerprint2.get = function(options, callback) {
          if (!callback) {
            callback = options;
            options = {};
          } else if (!options) {
            options = {};
          }
          extendSoft(options, defaultOptions);
          options.components = options.extraComponents.concat(components);
          var keys = {
            data: [],
            addPreprocessedComponent: function(key, value) {
              if (typeof options.preprocessor === "function") {
                value = options.preprocessor(key, value);
              }
              keys.data.push({ key, value });
            }
          };
          var i = -1;
          var chainComponents = function(alreadyWaited) {
            i += 1;
            if (i >= options.components.length) {
              callback(keys.data);
              return;
            }
            var component = options.components[i];
            if (options.excludes[component.key]) {
              chainComponents(false);
              return;
            }
            if (!alreadyWaited && component.pauseBefore) {
              i -= 1;
              setTimeout(function() {
                chainComponents(true);
              }, 1);
              return;
            }
            try {
              component.getData(function(value) {
                keys.addPreprocessedComponent(component.key, value);
                chainComponents(false);
              }, options);
            } catch (error2) {
              keys.addPreprocessedComponent(component.key, String(error2));
              chainComponents(false);
            }
          };
          chainComponents(false);
        };
        Fingerprint2.getPromise = function(options) {
          return new Promise(function(resolve, reject) {
            Fingerprint2.get(options, resolve);
          });
        };
        Fingerprint2.getV18 = function(options, callback) {
          if (callback == null) {
            callback = options;
            options = {};
          }
          return Fingerprint2.get(options, function(components2) {
            var newComponents = [];
            for (var i = 0; i < components2.length; i++) {
              var component = components2[i];
              if (component.value === (options.NOT_AVAILABLE || "not available")) {
                newComponents.push({ key: component.key, value: "unknown" });
              } else if (component.key === "plugins") {
                newComponents.push({
                  key: "plugins",
                  value: map(component.value, function(p) {
                    var mimeTypes = map(p[2], function(mt) {
                      if (mt.join) {
                        return mt.join("~");
                      }
                      return mt;
                    }).join(",");
                    return [p[0], p[1], mimeTypes].join("::");
                  })
                });
              } else if (["canvas", "webgl"].indexOf(component.key) !== -1 && Array.isArray(component.value)) {
                newComponents.push({ key: component.key, value: component.value.join("~") });
              } else if (["sessionStorage", "localStorage", "indexedDb", "addBehavior", "openDatabase"].indexOf(component.key) !== -1) {
                if (component.value) {
                  newComponents.push({ key: component.key, value: 1 });
                } else {
                  continue;
                }
              } else {
                if (component.value) {
                  newComponents.push(component.value.join ? { key: component.key, value: component.value.join(";") } : component);
                } else {
                  newComponents.push({ key: component.key, value: component.value });
                }
              }
            }
            var murmur = x64hash128(map(newComponents, function(component2) {
              return component2.value;
            }).join("~~~"), 31);
            callback(murmur, newComponents);
          });
        };
        Fingerprint2.x64hash128 = x64hash128;
        Fingerprint2.VERSION = "2.1.4";
        return Fingerprint2;
      });
    }
  });

  // node_modules/lodash.defaultsdeep/index.js
  var require_lodash = __commonJS({
    "node_modules/lodash.defaultsdeep/index.js"(exports, module) {
      var LARGE_ARRAY_SIZE = 200;
      var HASH_UNDEFINED = "__lodash_hash_undefined__";
      var HOT_COUNT = 800;
      var HOT_SPAN = 16;
      var MAX_SAFE_INTEGER = 9007199254740991;
      var argsTag = "[object Arguments]";
      var arrayTag = "[object Array]";
      var asyncTag = "[object AsyncFunction]";
      var boolTag = "[object Boolean]";
      var dateTag = "[object Date]";
      var errorTag = "[object Error]";
      var funcTag = "[object Function]";
      var genTag = "[object GeneratorFunction]";
      var mapTag = "[object Map]";
      var numberTag = "[object Number]";
      var nullTag = "[object Null]";
      var objectTag = "[object Object]";
      var proxyTag = "[object Proxy]";
      var regexpTag = "[object RegExp]";
      var setTag = "[object Set]";
      var stringTag = "[object String]";
      var undefinedTag = "[object Undefined]";
      var weakMapTag = "[object WeakMap]";
      var arrayBufferTag = "[object ArrayBuffer]";
      var dataViewTag = "[object DataView]";
      var float32Tag = "[object Float32Array]";
      var float64Tag = "[object Float64Array]";
      var int8Tag = "[object Int8Array]";
      var int16Tag = "[object Int16Array]";
      var int32Tag = "[object Int32Array]";
      var uint8Tag = "[object Uint8Array]";
      var uint8ClampedTag = "[object Uint8ClampedArray]";
      var uint16Tag = "[object Uint16Array]";
      var uint32Tag = "[object Uint32Array]";
      var reRegExpChar = /[\\^$.*+?()[\]{}|]/g;
      var reIsHostCtor = /^\[object .+?Constructor\]$/;
      var reIsUint = /^(?:0|[1-9]\d*)$/;
      var typedArrayTags = {};
      typedArrayTags[float32Tag] = typedArrayTags[float64Tag] = typedArrayTags[int8Tag] = typedArrayTags[int16Tag] = typedArrayTags[int32Tag] = typedArrayTags[uint8Tag] = typedArrayTags[uint8ClampedTag] = typedArrayTags[uint16Tag] = typedArrayTags[uint32Tag] = true;
      typedArrayTags[argsTag] = typedArrayTags[arrayTag] = typedArrayTags[arrayBufferTag] = typedArrayTags[boolTag] = typedArrayTags[dataViewTag] = typedArrayTags[dateTag] = typedArrayTags[errorTag] = typedArrayTags[funcTag] = typedArrayTags[mapTag] = typedArrayTags[numberTag] = typedArrayTags[objectTag] = typedArrayTags[regexpTag] = typedArrayTags[setTag] = typedArrayTags[stringTag] = typedArrayTags[weakMapTag] = false;
      var freeGlobal = typeof global == "object" && global && global.Object === Object && global;
      var freeSelf = typeof self == "object" && self && self.Object === Object && self;
      var root = freeGlobal || freeSelf || Function("return this")();
      var freeExports = typeof exports == "object" && exports && !exports.nodeType && exports;
      var freeModule = freeExports && typeof module == "object" && module && !module.nodeType && module;
      var moduleExports = freeModule && freeModule.exports === freeExports;
      var freeProcess = moduleExports && freeGlobal.process;
      var nodeUtil = function() {
        try {
          var types = freeModule && freeModule.require && freeModule.require("util").types;
          if (types) {
            return types;
          }
          return freeProcess && freeProcess.binding && freeProcess.binding("util");
        } catch (e2) {
        }
      }();
      var nodeIsTypedArray = nodeUtil && nodeUtil.isTypedArray;
      function apply(func, thisArg, args) {
        switch (args.length) {
          case 0:
            return func.call(thisArg);
          case 1:
            return func.call(thisArg, args[0]);
          case 2:
            return func.call(thisArg, args[0], args[1]);
          case 3:
            return func.call(thisArg, args[0], args[1], args[2]);
        }
        return func.apply(thisArg, args);
      }
      function baseTimes(n2, iteratee) {
        var index = -1, result = Array(n2);
        while (++index < n2) {
          result[index] = iteratee(index);
        }
        return result;
      }
      function baseUnary(func) {
        return function(value) {
          return func(value);
        };
      }
      function getValue(object, key) {
        return object == null ? void 0 : object[key];
      }
      function overArg(func, transform) {
        return function(arg) {
          return func(transform(arg));
        };
      }
      var arrayProto = Array.prototype;
      var funcProto = Function.prototype;
      var objectProto = Object.prototype;
      var coreJsData = root["__core-js_shared__"];
      var funcToString = funcProto.toString;
      var hasOwnProperty = objectProto.hasOwnProperty;
      var maskSrcKey = function() {
        var uid = /[^.]+$/.exec(coreJsData && coreJsData.keys && coreJsData.keys.IE_PROTO || "");
        return uid ? "Symbol(src)_1." + uid : "";
      }();
      var nativeObjectToString = objectProto.toString;
      var objectCtorString = funcToString.call(Object);
      var reIsNative = RegExp(
        "^" + funcToString.call(hasOwnProperty).replace(reRegExpChar, "\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g, "$1.*?") + "$"
      );
      var Buffer2 = moduleExports ? root.Buffer : void 0;
      var Symbol2 = root.Symbol;
      var Uint8Array2 = root.Uint8Array;
      var allocUnsafe = Buffer2 ? Buffer2.allocUnsafe : void 0;
      var getPrototype = overArg(Object.getPrototypeOf, Object);
      var objectCreate = Object.create;
      var propertyIsEnumerable = objectProto.propertyIsEnumerable;
      var splice = arrayProto.splice;
      var symToStringTag = Symbol2 ? Symbol2.toStringTag : void 0;
      var defineProperty = function() {
        try {
          var func = getNative(Object, "defineProperty");
          func({}, "", {});
          return func;
        } catch (e2) {
        }
      }();
      var nativeIsBuffer = Buffer2 ? Buffer2.isBuffer : void 0;
      var nativeMax = Math.max;
      var nativeNow = Date.now;
      var Map = getNative(root, "Map");
      var nativeCreate = getNative(Object, "create");
      var baseCreate = function() {
        function object() {
        }
        return function(proto) {
          if (!isObject(proto)) {
            return {};
          }
          if (objectCreate) {
            return objectCreate(proto);
          }
          object.prototype = proto;
          var result = new object();
          object.prototype = void 0;
          return result;
        };
      }();
      function Hash(entries) {
        var index = -1, length = entries == null ? 0 : entries.length;
        this.clear();
        while (++index < length) {
          var entry = entries[index];
          this.set(entry[0], entry[1]);
        }
      }
      function hashClear() {
        this.__data__ = nativeCreate ? nativeCreate(null) : {};
        this.size = 0;
      }
      function hashDelete(key) {
        var result = this.has(key) && delete this.__data__[key];
        this.size -= result ? 1 : 0;
        return result;
      }
      function hashGet(key) {
        var data = this.__data__;
        if (nativeCreate) {
          var result = data[key];
          return result === HASH_UNDEFINED ? void 0 : result;
        }
        return hasOwnProperty.call(data, key) ? data[key] : void 0;
      }
      function hashHas(key) {
        var data = this.__data__;
        return nativeCreate ? data[key] !== void 0 : hasOwnProperty.call(data, key);
      }
      function hashSet(key, value) {
        var data = this.__data__;
        this.size += this.has(key) ? 0 : 1;
        data[key] = nativeCreate && value === void 0 ? HASH_UNDEFINED : value;
        return this;
      }
      Hash.prototype.clear = hashClear;
      Hash.prototype["delete"] = hashDelete;
      Hash.prototype.get = hashGet;
      Hash.prototype.has = hashHas;
      Hash.prototype.set = hashSet;
      function ListCache(entries) {
        var index = -1, length = entries == null ? 0 : entries.length;
        this.clear();
        while (++index < length) {
          var entry = entries[index];
          this.set(entry[0], entry[1]);
        }
      }
      function listCacheClear() {
        this.__data__ = [];
        this.size = 0;
      }
      function listCacheDelete(key) {
        var data = this.__data__, index = assocIndexOf(data, key);
        if (index < 0) {
          return false;
        }
        var lastIndex = data.length - 1;
        if (index == lastIndex) {
          data.pop();
        } else {
          splice.call(data, index, 1);
        }
        --this.size;
        return true;
      }
      function listCacheGet(key) {
        var data = this.__data__, index = assocIndexOf(data, key);
        return index < 0 ? void 0 : data[index][1];
      }
      function listCacheHas(key) {
        return assocIndexOf(this.__data__, key) > -1;
      }
      function listCacheSet(key, value) {
        var data = this.__data__, index = assocIndexOf(data, key);
        if (index < 0) {
          ++this.size;
          data.push([key, value]);
        } else {
          data[index][1] = value;
        }
        return this;
      }
      ListCache.prototype.clear = listCacheClear;
      ListCache.prototype["delete"] = listCacheDelete;
      ListCache.prototype.get = listCacheGet;
      ListCache.prototype.has = listCacheHas;
      ListCache.prototype.set = listCacheSet;
      function MapCache(entries) {
        var index = -1, length = entries == null ? 0 : entries.length;
        this.clear();
        while (++index < length) {
          var entry = entries[index];
          this.set(entry[0], entry[1]);
        }
      }
      function mapCacheClear() {
        this.size = 0;
        this.__data__ = {
          "hash": new Hash(),
          "map": new (Map || ListCache)(),
          "string": new Hash()
        };
      }
      function mapCacheDelete(key) {
        var result = getMapData(this, key)["delete"](key);
        this.size -= result ? 1 : 0;
        return result;
      }
      function mapCacheGet(key) {
        return getMapData(this, key).get(key);
      }
      function mapCacheHas(key) {
        return getMapData(this, key).has(key);
      }
      function mapCacheSet(key, value) {
        var data = getMapData(this, key), size = data.size;
        data.set(key, value);
        this.size += data.size == size ? 0 : 1;
        return this;
      }
      MapCache.prototype.clear = mapCacheClear;
      MapCache.prototype["delete"] = mapCacheDelete;
      MapCache.prototype.get = mapCacheGet;
      MapCache.prototype.has = mapCacheHas;
      MapCache.prototype.set = mapCacheSet;
      function Stack(entries) {
        var data = this.__data__ = new ListCache(entries);
        this.size = data.size;
      }
      function stackClear() {
        this.__data__ = new ListCache();
        this.size = 0;
      }
      function stackDelete(key) {
        var data = this.__data__, result = data["delete"](key);
        this.size = data.size;
        return result;
      }
      function stackGet(key) {
        return this.__data__.get(key);
      }
      function stackHas(key) {
        return this.__data__.has(key);
      }
      function stackSet(key, value) {
        var data = this.__data__;
        if (data instanceof ListCache) {
          var pairs = data.__data__;
          if (!Map || pairs.length < LARGE_ARRAY_SIZE - 1) {
            pairs.push([key, value]);
            this.size = ++data.size;
            return this;
          }
          data = this.__data__ = new MapCache(pairs);
        }
        data.set(key, value);
        this.size = data.size;
        return this;
      }
      Stack.prototype.clear = stackClear;
      Stack.prototype["delete"] = stackDelete;
      Stack.prototype.get = stackGet;
      Stack.prototype.has = stackHas;
      Stack.prototype.set = stackSet;
      function arrayLikeKeys(value, inherited) {
        var isArr = isArray(value), isArg = !isArr && isArguments(value), isBuff = !isArr && !isArg && isBuffer(value), isType = !isArr && !isArg && !isBuff && isTypedArray(value), skipIndexes = isArr || isArg || isBuff || isType, result = skipIndexes ? baseTimes(value.length, String) : [], length = result.length;
        for (var key in value) {
          if ((inherited || hasOwnProperty.call(value, key)) && !(skipIndexes && (key == "length" || isBuff && (key == "offset" || key == "parent") || isType && (key == "buffer" || key == "byteLength" || key == "byteOffset") || isIndex(key, length)))) {
            result.push(key);
          }
        }
        return result;
      }
      function assignMergeValue(object, key, value) {
        if (value !== void 0 && !eq(object[key], value) || value === void 0 && !(key in object)) {
          baseAssignValue(object, key, value);
        }
      }
      function assignValue(object, key, value) {
        var objValue = object[key];
        if (!(hasOwnProperty.call(object, key) && eq(objValue, value)) || value === void 0 && !(key in object)) {
          baseAssignValue(object, key, value);
        }
      }
      function assocIndexOf(array, key) {
        var length = array.length;
        while (length--) {
          if (eq(array[length][0], key)) {
            return length;
          }
        }
        return -1;
      }
      function baseAssignValue(object, key, value) {
        if (key == "__proto__" && defineProperty) {
          defineProperty(object, key, {
            "configurable": true,
            "enumerable": true,
            "value": value,
            "writable": true
          });
        } else {
          object[key] = value;
        }
      }
      var baseFor = createBaseFor();
      function baseGetTag(value) {
        if (value == null) {
          return value === void 0 ? undefinedTag : nullTag;
        }
        return symToStringTag && symToStringTag in Object(value) ? getRawTag(value) : objectToString(value);
      }
      function baseIsArguments(value) {
        return isObjectLike(value) && baseGetTag(value) == argsTag;
      }
      function baseIsNative(value) {
        if (!isObject(value) || isMasked(value)) {
          return false;
        }
        var pattern = isFunction(value) ? reIsNative : reIsHostCtor;
        return pattern.test(toSource(value));
      }
      function baseIsTypedArray(value) {
        return isObjectLike(value) && isLength(value.length) && !!typedArrayTags[baseGetTag(value)];
      }
      function baseKeysIn(object) {
        if (!isObject(object)) {
          return nativeKeysIn(object);
        }
        var isProto = isPrototype(object), result = [];
        for (var key in object) {
          if (!(key == "constructor" && (isProto || !hasOwnProperty.call(object, key)))) {
            result.push(key);
          }
        }
        return result;
      }
      function baseMerge(object, source, srcIndex, customizer, stack) {
        if (object === source) {
          return;
        }
        baseFor(source, function(srcValue, key) {
          stack || (stack = new Stack());
          if (isObject(srcValue)) {
            baseMergeDeep(object, source, key, srcIndex, baseMerge, customizer, stack);
          } else {
            var newValue = customizer ? customizer(safeGet(object, key), srcValue, key + "", object, source, stack) : void 0;
            if (newValue === void 0) {
              newValue = srcValue;
            }
            assignMergeValue(object, key, newValue);
          }
        }, keysIn);
      }
      function baseMergeDeep(object, source, key, srcIndex, mergeFunc, customizer, stack) {
        var objValue = safeGet(object, key), srcValue = safeGet(source, key), stacked = stack.get(srcValue);
        if (stacked) {
          assignMergeValue(object, key, stacked);
          return;
        }
        var newValue = customizer ? customizer(objValue, srcValue, key + "", object, source, stack) : void 0;
        var isCommon = newValue === void 0;
        if (isCommon) {
          var isArr = isArray(srcValue), isBuff = !isArr && isBuffer(srcValue), isTyped = !isArr && !isBuff && isTypedArray(srcValue);
          newValue = srcValue;
          if (isArr || isBuff || isTyped) {
            if (isArray(objValue)) {
              newValue = objValue;
            } else if (isArrayLikeObject(objValue)) {
              newValue = copyArray(objValue);
            } else if (isBuff) {
              isCommon = false;
              newValue = cloneBuffer(srcValue, true);
            } else if (isTyped) {
              isCommon = false;
              newValue = cloneTypedArray(srcValue, true);
            } else {
              newValue = [];
            }
          } else if (isPlainObject(srcValue) || isArguments(srcValue)) {
            newValue = objValue;
            if (isArguments(objValue)) {
              newValue = toPlainObject(objValue);
            } else if (!isObject(objValue) || isFunction(objValue)) {
              newValue = initCloneObject(srcValue);
            }
          } else {
            isCommon = false;
          }
        }
        if (isCommon) {
          stack.set(srcValue, newValue);
          mergeFunc(newValue, srcValue, srcIndex, customizer, stack);
          stack["delete"](srcValue);
        }
        assignMergeValue(object, key, newValue);
      }
      function baseRest(func, start) {
        return setToString(overRest(func, start, identity), func + "");
      }
      var baseSetToString = !defineProperty ? identity : function(func, string) {
        return defineProperty(func, "toString", {
          "configurable": true,
          "enumerable": false,
          "value": constant(string),
          "writable": true
        });
      };
      function cloneBuffer(buffer, isDeep) {
        if (isDeep) {
          return buffer.slice();
        }
        var length = buffer.length, result = allocUnsafe ? allocUnsafe(length) : new buffer.constructor(length);
        buffer.copy(result);
        return result;
      }
      function cloneArrayBuffer(arrayBuffer) {
        var result = new arrayBuffer.constructor(arrayBuffer.byteLength);
        new Uint8Array2(result).set(new Uint8Array2(arrayBuffer));
        return result;
      }
      function cloneTypedArray(typedArray, isDeep) {
        var buffer = isDeep ? cloneArrayBuffer(typedArray.buffer) : typedArray.buffer;
        return new typedArray.constructor(buffer, typedArray.byteOffset, typedArray.length);
      }
      function copyArray(source, array) {
        var index = -1, length = source.length;
        array || (array = Array(length));
        while (++index < length) {
          array[index] = source[index];
        }
        return array;
      }
      function copyObject(source, props, object, customizer) {
        var isNew = !object;
        object || (object = {});
        var index = -1, length = props.length;
        while (++index < length) {
          var key = props[index];
          var newValue = customizer ? customizer(object[key], source[key], key, object, source) : void 0;
          if (newValue === void 0) {
            newValue = source[key];
          }
          if (isNew) {
            baseAssignValue(object, key, newValue);
          } else {
            assignValue(object, key, newValue);
          }
        }
        return object;
      }
      function createAssigner(assigner) {
        return baseRest(function(object, sources) {
          var index = -1, length = sources.length, customizer = length > 1 ? sources[length - 1] : void 0, guard = length > 2 ? sources[2] : void 0;
          customizer = assigner.length > 3 && typeof customizer == "function" ? (length--, customizer) : void 0;
          if (guard && isIterateeCall(sources[0], sources[1], guard)) {
            customizer = length < 3 ? void 0 : customizer;
            length = 1;
          }
          object = Object(object);
          while (++index < length) {
            var source = sources[index];
            if (source) {
              assigner(object, source, index, customizer);
            }
          }
          return object;
        });
      }
      function createBaseFor(fromRight) {
        return function(object, iteratee, keysFunc) {
          var index = -1, iterable = Object(object), props = keysFunc(object), length = props.length;
          while (length--) {
            var key = props[fromRight ? length : ++index];
            if (iteratee(iterable[key], key, iterable) === false) {
              break;
            }
          }
          return object;
        };
      }
      function customDefaultsMerge(objValue, srcValue, key, object, source, stack) {
        if (isObject(objValue) && isObject(srcValue)) {
          stack.set(srcValue, objValue);
          baseMerge(objValue, srcValue, void 0, customDefaultsMerge, stack);
          stack["delete"](srcValue);
        }
        return objValue;
      }
      function getMapData(map, key) {
        var data = map.__data__;
        return isKeyable(key) ? data[typeof key == "string" ? "string" : "hash"] : data.map;
      }
      function getNative(object, key) {
        var value = getValue(object, key);
        return baseIsNative(value) ? value : void 0;
      }
      function getRawTag(value) {
        var isOwn = hasOwnProperty.call(value, symToStringTag), tag = value[symToStringTag];
        try {
          value[symToStringTag] = void 0;
          var unmasked = true;
        } catch (e2) {
        }
        var result = nativeObjectToString.call(value);
        if (unmasked) {
          if (isOwn) {
            value[symToStringTag] = tag;
          } else {
            delete value[symToStringTag];
          }
        }
        return result;
      }
      function initCloneObject(object) {
        return typeof object.constructor == "function" && !isPrototype(object) ? baseCreate(getPrototype(object)) : {};
      }
      function isIndex(value, length) {
        var type = typeof value;
        length = length == null ? MAX_SAFE_INTEGER : length;
        return !!length && (type == "number" || type != "symbol" && reIsUint.test(value)) && (value > -1 && value % 1 == 0 && value < length);
      }
      function isIterateeCall(value, index, object) {
        if (!isObject(object)) {
          return false;
        }
        var type = typeof index;
        if (type == "number" ? isArrayLike(object) && isIndex(index, object.length) : type == "string" && index in object) {
          return eq(object[index], value);
        }
        return false;
      }
      function isKeyable(value) {
        var type = typeof value;
        return type == "string" || type == "number" || type == "symbol" || type == "boolean" ? value !== "__proto__" : value === null;
      }
      function isMasked(func) {
        return !!maskSrcKey && maskSrcKey in func;
      }
      function isPrototype(value) {
        var Ctor = value && value.constructor, proto = typeof Ctor == "function" && Ctor.prototype || objectProto;
        return value === proto;
      }
      function nativeKeysIn(object) {
        var result = [];
        if (object != null) {
          for (var key in Object(object)) {
            result.push(key);
          }
        }
        return result;
      }
      function objectToString(value) {
        return nativeObjectToString.call(value);
      }
      function overRest(func, start, transform) {
        start = nativeMax(start === void 0 ? func.length - 1 : start, 0);
        return function() {
          var args = arguments, index = -1, length = nativeMax(args.length - start, 0), array = Array(length);
          while (++index < length) {
            array[index] = args[start + index];
          }
          index = -1;
          var otherArgs = Array(start + 1);
          while (++index < start) {
            otherArgs[index] = args[index];
          }
          otherArgs[start] = transform(array);
          return apply(func, this, otherArgs);
        };
      }
      function safeGet(object, key) {
        if (key === "constructor" && typeof object[key] === "function") {
          return;
        }
        if (key == "__proto__") {
          return;
        }
        return object[key];
      }
      var setToString = shortOut(baseSetToString);
      function shortOut(func) {
        var count = 0, lastCalled = 0;
        return function() {
          var stamp = nativeNow(), remaining = HOT_SPAN - (stamp - lastCalled);
          lastCalled = stamp;
          if (remaining > 0) {
            if (++count >= HOT_COUNT) {
              return arguments[0];
            }
          } else {
            count = 0;
          }
          return func.apply(void 0, arguments);
        };
      }
      function toSource(func) {
        if (func != null) {
          try {
            return funcToString.call(func);
          } catch (e2) {
          }
          try {
            return func + "";
          } catch (e2) {
          }
        }
        return "";
      }
      function eq(value, other) {
        return value === other || value !== value && other !== other;
      }
      var isArguments = baseIsArguments(function() {
        return arguments;
      }()) ? baseIsArguments : function(value) {
        return isObjectLike(value) && hasOwnProperty.call(value, "callee") && !propertyIsEnumerable.call(value, "callee");
      };
      var isArray = Array.isArray;
      function isArrayLike(value) {
        return value != null && isLength(value.length) && !isFunction(value);
      }
      function isArrayLikeObject(value) {
        return isObjectLike(value) && isArrayLike(value);
      }
      var isBuffer = nativeIsBuffer || stubFalse;
      function isFunction(value) {
        if (!isObject(value)) {
          return false;
        }
        var tag = baseGetTag(value);
        return tag == funcTag || tag == genTag || tag == asyncTag || tag == proxyTag;
      }
      function isLength(value) {
        return typeof value == "number" && value > -1 && value % 1 == 0 && value <= MAX_SAFE_INTEGER;
      }
      function isObject(value) {
        var type = typeof value;
        return value != null && (type == "object" || type == "function");
      }
      function isObjectLike(value) {
        return value != null && typeof value == "object";
      }
      function isPlainObject(value) {
        if (!isObjectLike(value) || baseGetTag(value) != objectTag) {
          return false;
        }
        var proto = getPrototype(value);
        if (proto === null) {
          return true;
        }
        var Ctor = hasOwnProperty.call(proto, "constructor") && proto.constructor;
        return typeof Ctor == "function" && Ctor instanceof Ctor && funcToString.call(Ctor) == objectCtorString;
      }
      var isTypedArray = nodeIsTypedArray ? baseUnary(nodeIsTypedArray) : baseIsTypedArray;
      function toPlainObject(value) {
        return copyObject(value, keysIn(value));
      }
      var defaultsDeep = baseRest(function(args) {
        args.push(void 0, customDefaultsMerge);
        return apply(mergeWith, void 0, args);
      });
      function keysIn(object) {
        return isArrayLike(object) ? arrayLikeKeys(object, true) : baseKeysIn(object);
      }
      var mergeWith = createAssigner(function(object, source, srcIndex, customizer) {
        baseMerge(object, source, srcIndex, customizer);
      });
      function constant(value) {
        return function() {
          return value;
        };
      }
      function identity(value) {
        return value;
      }
      function stubFalse() {
        return false;
      }
      module.exports = defaultsDeep;
    }
  });

  // app/javascript/script/flash.js
  var create = (header, body, type = "default") => {
    const item = document.createElement("li");
    item.classList.add("sl-popup-item");
    item.setAttribute("data-type", type);
    if (type != "default") {
      const icon = document.createElement("div");
      icon.classList.add("sl-popup-icon");
      icon.classList.add(`sl-popup-${type}-icon`);
      item.appendChild(icon);
    }
    const close = document.createElement("div");
    close.classList.add("sl-popup-close");
    item.appendChild(close);
    close.addEventListener("click", () => item.remove());
    const text_container = document.createElement("div");
    text_container.classList.add("sl-popup-text-container");
    const item_header = document.createElement("h3");
    item_header.innerText = header;
    text_container.appendChild(item_header);
    const item_body = document.createElement("p");
    item_body.innerHTML = body;
    text_container.appendChild(item_body);
    item.appendChild(text_container);
    if (document.getElementById("sl-popup-container")) {
      const container = document.getElementById("sl-popup-container");
      container.appendChild(item);
    } else {
      const container = document.createElement("ul");
      container.id = "sl-popup-container";
      container.appendChild(item);
      const body2 = document.getElementsByTagName("body")[0];
      body2.appendChild(container);
    }
  };
  var success = (header, body) => {
    create(header, body, "success");
  };
  var warning = (header, body) => {
    create(header, body, "warning");
  };
  var error = (header, body) => {
    create(header, body, "error");
  };
  var message = (header, body) => {
    create(header, body);
  };

  // node_modules/js-cookie/dist/js.cookie.mjs
  function assign(target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];
      for (var key in source) {
        target[key] = source[key];
      }
    }
    return target;
  }
  var defaultConverter = {
    read: function(value) {
      if (value[0] === '"') {
        value = value.slice(1, -1);
      }
      return value.replace(/(%[\dA-F]{2})+/gi, decodeURIComponent);
    },
    write: function(value) {
      return encodeURIComponent(value).replace(
        /%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,
        decodeURIComponent
      );
    }
  };
  function init(converter, defaultAttributes) {
    function set(key, value, attributes) {
      if (typeof document === "undefined") {
        return;
      }
      attributes = assign({}, defaultAttributes, attributes);
      if (typeof attributes.expires === "number") {
        attributes.expires = new Date(Date.now() + attributes.expires * 864e5);
      }
      if (attributes.expires) {
        attributes.expires = attributes.expires.toUTCString();
      }
      key = encodeURIComponent(key).replace(/%(2[346B]|5E|60|7C)/g, decodeURIComponent).replace(/[()]/g, escape);
      var stringifiedAttributes = "";
      for (var attributeName in attributes) {
        if (!attributes[attributeName]) {
          continue;
        }
        stringifiedAttributes += "; " + attributeName;
        if (attributes[attributeName] === true) {
          continue;
        }
        stringifiedAttributes += "=" + attributes[attributeName].split(";")[0];
      }
      return document.cookie = key + "=" + converter.write(value, key) + stringifiedAttributes;
    }
    function get(key) {
      if (typeof document === "undefined" || arguments.length && !key) {
        return;
      }
      var cookies = document.cookie ? document.cookie.split("; ") : [];
      var jar = {};
      for (var i = 0; i < cookies.length; i++) {
        var parts = cookies[i].split("=");
        var value = parts.slice(1).join("=");
        try {
          var foundKey = decodeURIComponent(parts[0]);
          jar[foundKey] = converter.read(value, foundKey);
          if (key === foundKey) {
            break;
          }
        } catch (e2) {
        }
      }
      return key ? jar[key] : jar;
    }
    return Object.create(
      {
        set,
        get,
        remove: function(key, attributes) {
          set(
            key,
            "",
            assign({}, attributes, {
              expires: -1
            })
          );
        },
        withAttributes: function(attributes) {
          return init(this.converter, assign({}, this.attributes, attributes));
        },
        withConverter: function(converter2) {
          return init(assign({}, this.converter, converter2), this.attributes);
        }
      },
      {
        attributes: { value: Object.freeze(defaultAttributes) },
        converter: { value: Object.freeze(converter) }
      }
    );
  }
  var api = init(defaultConverter, { path: "/" });
  var js_cookie_default = api;

  // app/javascript/script/utils.js
  var getUrlParam = (param) => {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(param);
  };
  var wildcardToRegExp = (s) => {
    return new RegExp("^" + s.split(/\*+/).map(regExpEscape).join(".*") + "$");
  };
  var regExpEscape = (s) => {
    return s.replace(/[|\\{}()[\]^$+*?.]/g, "\\$&");
  };
  var triggerEvent = (name) => {
    const event = new Event(`sl:${name}`);
    document.dispatchEvent(event);
  };
  var isVerificationMode = () => {
    return !!getUrlParam("SLVerifyInstall");
  };
  var isCampaignVerification = () => {
    return isVerificationMode() && getUrlParam("SLVerifyInstall").includes("MF");
  };
  var isUpscribeVerification = () => {
    return isVerificationMode() && getUrlParam("SLVerifyInstall").includes("upscribe");
  };
  var isPartnerProgramVerification = () => {
    return isVerificationMode() && getUrlParam("SLVerifyInstall").includes("partner_program");
  };
  var isTestMode = () => {
    return window.SL.config.test_mode || getUrlParam("test_mode") == "true";
  };
  var isDebugMode = () => {
    return getUrlParam("debug") == "true";
  };
  var isPartnerMode = () => {
    return getUrlParam("partner_mode") == "true";
  };
  var isHostedReferralHubPage = () => {
    return window.location.hostname === "referralhub.page";
  };
  var globalConfig = () => {
    return window.SL.config || {};
  };
  var visitorData = (attrs = {}) => {
    let visitor = window.SL.visitor || {};
    if (Object.keys(attrs).length) {
      visitor = Object.assign(visitor, attrs);
    }
    ;
    window.SL.visitor = visitor;
    return window.SL.visitor;
  };
  var subscriberData = (attrs = null) => {
    let visitor = visitorData();
    if (attrs && Object.keys(visitor).length) {
      visitor.subscriber = attrs;
      triggerEvent("subscriber-updated");
    }
    ;
    return visitor.subscriber;
  };
  var retrieveReferrerCode = () => {
    return isVerificationMode() ? getUrlParam("rh_ref") : visitorData().referrer;
  };
  var retrieveUpscribeSettings = (upscribe_id = null) => {
    const upscribes = globalConfig().widgets.upscribes;
    const upscribeSettings = upscribe_id ? upscribes.find((upscribe2) => upscribe2.uuid == upscribe_id) : upscribes[0];
    return upscribeSettings;
  };
  var subscriberFormData = () => {
    const visitor = visitorData();
    return {
      uuid: globalConfig().uuid,
      referrer_code: retrieveReferrerCode(),
      campaign_id: visitor.campaign,
      utm_source: visitor.utm_source,
      utm_campaign: visitor.utm_campaign,
      fingerprint: visitor.fingerprint,
      origin: visitor.origin,
      email: visitor.email
    };
  };
  var showFlashMessages = () => {
    return getUrlParam("flash_messages") == "true";
  };
  var showTestModeBanner = () => {
    if (isTestMode() && showFlashMessages()) {
      message("TEST MODE ENABLED", "You're currently in test mode. No data will be stored while in test mode");
    }
  };
  var widgetsAllowed = () => {
    return window.SLConfig.plan != "lite_v3" || isTestMode() || isHostedReferralHubPage();
  };
  var storeCookie = (name, value, days = 30) => {
    if (isVerificationMode() || isTestMode()) {
      return false;
    }
    const rootDomain = window.location.hostname.replace("www.", "");
    if (value) {
      js_cookie_default.set(name, value, { expires: days, domain: `.${rootDomain}` });
      console.log(`${name} tracked`);
    }
  };
  var setDefaultCssVariables = () => {
    document.documentElement.style.setProperty("--sl-widgets-font-family", "-apple-system, system-ui");
    document.documentElement.style.setProperty("--sl-widgets-base-unit", "16px");
  };
  var loadCustomCSS = (name, custom_css) => {
    const style_id = `sparkloop-${name}-custom-css`;
    if (document.getElementById(style_id)) {
      document.getElementById(style_id).remove();
    }
    var el = document.createElement("style");
    el.type = "text/css";
    el.id = style_id;
    el.textContent = custom_css;
    document.head.appendChild(el);
  };
  var loadStylesheet = (stylesheet) => {
    const id = `sparkloop-${stylesheet}-style`;
    if (document.querySelector(`link#${id}`)) {
      return;
    }
    const el = document.createElement("link");
    el.id = id;
    el.setAttribute("rel", "stylesheet");
    el.setAttribute("href", `${window.SLConfig.app_url}/styles/${stylesheet}.css`);
    document.head.appendChild(el);
  };
  var preloadAsset = (url) => {
    const el = document.createElement("link");
    el.setAttribute("rel", "preload");
    el.setAttribute("as", "image");
    el.setAttribute("href", url);
    document.head.appendChild(el);
  };
  var copyToClipboard = (el, b, copied) => {
    let succeeded;
    if (document.body.createTextRange) {
      const textRange = document.body.createTextRange();
      textRange.moveToElementText(el);
      textRange.select();
    } else if (window.getSelection && document.createRange) {
      el.readOnly = false;
      const range = document.createRange();
      range.selectNodeContents(el);
      const sel = window.getSelection();
      sel.removeAllRanges();
      sel.addRange(range);
      if (el.nodeName == "TEXTAREA" || el.nodeName == "INPUT") {
        el.select();
      }
      if (el.setSelectionRange && navigator.userAgent.match(/ipad|ipod|iphone/i)) {
        el.setSelectionRange(0, 999999);
        el.readOnly = true;
      }
    }
    try {
      succeeded = document.execCommand("copy");
    } catch (n2) {
      succeeded = false;
    }
    if (succeeded) {
      const r2 = b.textContent;
      const i = copied;
      b.textContent = i;
      setTimeout(() => b.textContent = r2, 500);
      console.log("Referral link copied to clipboard.");
    }
  };
  var detectEmailInForm = (formEl) => {
    const email = formEl.querySelector("input[type*=email]") || formEl.querySelector("input[type*=Email]") || formEl.querySelector("input[type*=EMAIL]") || formEl.querySelector("input[name*=EMAIL]") || formEl.querySelector("input[name*=email]") || formEl.querySelector("input[name*=Email]") || formEl.querySelector("input[for*=email]") || formEl.querySelector("input[for*=Email]") || formEl.querySelector("input[for*=EMAIL]");
    return email;
  };
  var isGravityFormsWithoutEmail = (forms) => {
    let isGravityForm = false;
    let emailDetected = false;
    forms.forEach((form) => {
      if (form.querySelector(".gform_body")) {
        isGravityForm = true;
      }
      if (detectEmailInForm(form)) {
        emailDetected = true;
      }
    });
    return isGravityForm && !emailDetected;
  };
  var numberWithCommas = (x) => x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
  var createElement = ({ type = "div", id = "", classes = "", text = "", html = "", parent, attributes = {} } = {}) => {
    const el = document.createElement(type);
    if (id) {
      el.id = id;
    }
    if (classes) {
      el.className = classes;
    }
    if (text) {
      el.innerText = text;
    }
    if (html) {
      el.innerHTML = html;
    }
    if (parent) {
      parent.appendChild(el);
    }
    for (const name in attributes) {
      el.setAttribute(name, attributes[name]);
    }
    return el;
  };
  var poweredByLink = (source, parent, path = "") => {
    const powered_by_url = `https://sparkloop.app/${path}?utm_campaign=powered-by&utm_source=${source}&utm_medium=${globalConfig().uuid}`;
    return createElement({
      type: "a",
      attributes: {
        "href": powered_by_url,
        "target": "_blank"
      },
      text: "\u26A1\uFE0F by SparkLoop",
      parent
    });
  };
  var proxyComponents = () => {
    const fn = () => createElement({
      html: "<!-- Sparkloop: this plan doesn't support widgets -->"
    });
    const handler = {
      get: function() {
        return fn;
      }
    };
    return new Proxy({}, handler);
  };

  // app/javascript/script/api.js
  var fetchRequest = async (url, data, method = "POST") => {
    const config = globalConfig();
    const baseURL = `${config.script_url}/${config.uuid}`;
    const response = await fetch(baseURL + url, {
      method,
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify(data),
      keepalive: true
    });
    const parsedJson = await response.json();
    return parsedJson;
  };
  var subscribe = (data) => {
    return fetchRequest("/add_subscriber", data).then((resp) => resp);
  };
  var verifyScriptCampaigns = (data) => {
    return fetchRequest(`/campaigns/${data.campaign_id}/verify_script`, data).then((resp) => resp);
  };
  var testReferral = (data) => {
    return fetchRequest(`/campaigns/${data.campaign_id}/test_referral`, data).then((resp) => resp);
  };
  var upscribe = (upscribe_id, data) => {
    return fetchRequest(`/upscribes/${upscribe_id}/add_log`, data).then((resp) => resp);
  };
  var verifyScriptUpscribe = (upscribe_id) => {
    return fetchRequest(`/upscribes/${upscribe_id}/verify_script`).then((resp) => resp);
  };
  var verifyScriptPartnerProgram = (partner_program_id) => {
    return fetchRequest(`/partner_programs/${partner_program_id}/verify_script`).then((resp) => resp);
  };
  var testUpscribeWidget = (upscribe_id) => {
    return fetchRequest(`/upscribes/${upscribe_id}/test_widget`).then((resp) => resp);
  };
  var testPartnerProgramReferral2 = (partner_program_id) => {
    return fetchRequest(`/partner_programs/${partner_program_id}/test_referral`).then((resp) => resp);
  };
  var testPartnerReferral = (partnerCampaignId) => {
    return fetchRequest(`/partner_campaigns/${partnerCampaignId}/partner_test`).then((resp) => resp);
  };
  var createUpscribeEvent = (upscribe_id, data) => {
    return fetchRequest(`/upscribes/${upscribe_id}/add_event`, data).then((resp) => resp);
  };
  var verifyReferrer = (data) => {
    return fetchRequest("/check_referral_code", data).then((resp) => resp);
  };
  var verifyPartner = (data) => {
    return fetchRequest("/check_partner_code", data).then((resp) => resp);
  };
  var fetchSubscriber = (subscriber, visitor) => {
    return fetchRequest("/get_subscriber", {
      subscriber,
      ...visitor
    }).then((resp) => {
      if (resp.response === "error") {
        return Promise.reject(resp.message);
      } else {
        return Promise.resolve(resp.subscriber);
      }
    });
  };
  var upsertSubscriber = (subscriber, visitor) => {
    return fetchRequest("/upsert_subscriber", {
      subscriber,
      ...visitor
    }).then((resp) => {
      if (resp.response === "error") {
        return Promise.reject(resp.message);
      } else {
        return Promise.resolve(resp.subscriber);
      }
    });
  };
  var sendEmailInvitation = (data) => {
    return fetchRequest(`/campaigns/${data.campaign_id}/send_email_invite`, data).then((resp) => {
      return Promise.resolve(resp);
    }).catch(() => {
      return Promise.reject();
    });
  };

  // app/javascript/script/visitor.js
  var import_fingerprintjs2 = __toESM(require_fingerprint2());
  var COOKIE_NAME_SPACE = "__sl";
  var CAMPAIGN_COOKIE = `${COOKIE_NAME_SPACE}-campaign`;
  var UTMCAMPAIGN_COOKIE = `${COOKIE_NAME_SPACE}-utm_campaign`;
  var UTMSOURCE_COOKIE = `${COOKIE_NAME_SPACE}-utm_source`;
  var ORIGIN_COOKIE = `${COOKIE_NAME_SPACE}-origin`;
  var FINGERPRINT_COOKIE = `${COOKIE_NAME_SPACE}-fingerprint`;
  var REFERRER_COOKIE = `${COOKIE_NAME_SPACE}-referrer`;
  var Visitor = class {
    constructor() {
      this.config = globalConfig();
      this.visitor = {};
    }
    storeInfoCookies() {
      if (this.visitor.campaign) {
        storeCookie(`${CAMPAIGN_COOKIE}-${this.config.uuid}`, this.visitor.campaign);
      }
      if (this.visitor.utm_source) {
        storeCookie(`${UTMSOURCE_COOKIE}-${this.config.uuid}`, this.visitor.utm_source);
      }
      if (this.visitor.utm_campaign) {
        storeCookie(`${UTMCAMPAIGN_COOKIE}-${this.config.uuid}`, this.visitor.utm_campaign);
      }
      if (this.visitor.origin) {
        storeCookie(`${ORIGIN_COOKIE}-${this.config.uuid}`, this.visitor.origin);
      }
    }
    fetchCampaign() {
      const cookie = js_cookie_default.get(`${REFERRER_COOKIE}-${this.config.uuid}`) ? js_cookie_default.get(`${CAMPAIGN_COOKIE}-${this.config.uuid}`) : getUrlParam("sl_campaign");
      this.visitor.campaign = this.config.campaign || cookie || getUrlParam("sl_campaign");
    }
    fetchUTMCampaign() {
      this.visitor.utm_campaign = this.config.utm_campaign || getUrlParam("utm_campaign") || js_cookie_default.get(`${UTMCAMPAIGN_COOKIE}-${this.config.uuid}`);
    }
    fetchUTMSource() {
      const sourceParam = getUrlParam("utm_source") || getUrlParam("ref") || getUrlParam("source");
      const sourceCookie = js_cookie_default.get(`${UTMSOURCE_COOKIE}-${this.config.uuid}`);
      const referrer = document.referrer && new URL(document.referrer).hostname != window.location.hostname ? new URL(document.referrer).hostname.replace(/^www\./, "") : null;
      this.visitor.utm_source = this.config.utm_source || sourceParam || referrer || sourceCookie;
    }
    fetchOrigin() {
      this.visitor.origin = this.config.origin || js_cookie_default.get(`${ORIGIN_COOKIE}-${this.config.uuid}`);
    }
    async fetchAndVerifyReferrer() {
      let cookieName = `${REFERRER_COOKIE}-${this.config.uuid}`;
      const cookie = js_cookie_default.get(cookieName);
      if (cookie) {
        this.storeInfoCookies();
        this.visitor.referrer = cookie;
      }
      const referrerParam = getUrlParam("rh_ref") || getUrlParam("rh_partner");
      if (referrerParam) {
        const params = {
          uuid: this.config.uuid,
          referrer_code: referrerParam,
          campaign_id: this.visitor.campaign,
          utm_source: this.visitor.utm_source,
          utm_campaign: this.visitor.utm_campaign
        };
        let request;
        try {
          if (getUrlParam("rh_partner")) {
            request = await verifyPartner(params);
            console.log(`Partner Campaign Referral Code ${referrerParam} verified successfully`);
          } else {
            request = await verifyReferrer(params);
            console.log("REQ:", request);
            console.log(`Subscriber Referral code ${referrerParam} verified successfully`);
          }
          if (request.response == "ok") {
            triggerEvent("referrer-tracked");
            storeCookie(cookieName, referrerParam);
            this.visitor.referrer = referrerParam;
            this.storeInfoCookies();
          } else {
            console.warn(request.message);
          }
        } catch (error2) {
          console.error(error2);
        }
      }
    }
    calculateFingerprint() {
      return new Promise((resolve, reject) => {
        const wrapper = window.requestIdleCallback || window.setTimeout;
        wrapper(() => {
          import_fingerprintjs2.default.get((values) => {
            const result = import_fingerprintjs2.default.x64hash128(values.join(""), 31);
            return resolve(result);
          });
        });
      });
    }
    async fetchFingerprint() {
      const cookie = js_cookie_default.get(FINGERPRINT_COOKIE);
      if (cookie) {
        this.visitor.fingerprint = cookie;
      } else {
        try {
          const fingerprint = await this.calculateFingerprint();
          storeCookie(FINGERPRINT_COOKIE, fingerprint);
          this.visitor.fingerprint = fingerprint;
        } catch (error2) {
          console.error(error2);
        }
      }
    }
    async profile() {
      this.fetchCampaign();
      this.fetchUTMSource();
      this.fetchUTMCampaign();
      this.fetchOrigin();
      await this.fetchAndVerifyReferrer();
      await this.fetchFingerprint();
      visitorData(this.visitor);
    }
  };

  // app/javascript/script/subscriber.js
  var COOKIE_NAME_SPACE2 = "__sl";
  var SUBSCRIBER_COOKIE = `${COOKIE_NAME_SPACE2}-subscriber`;
  var Subscriber = class {
    constructor() {
      this.config = globalConfig();
    }
    subscriberId() {
      return js_cookie_default.get(`${SUBSCRIBER_COOKIE}-${this.config.uuid}`) || getUrlParam("subscriber_id");
    }
    async fetch({ subscriberId = null, campaign = null } = {}) {
      const subscriber = isTestMode() ? "fake_subscriber" : subscriberId || this.subscriberId();
      if (!subscriber) {
        return Promise.reject("Subscriber ID or email not present");
      }
      let subscriberFormData2 = subscriberFormData();
      if (campaign) {
        subscriberFormData2.campaign_id = campaign;
      }
      try {
        const response = await fetchSubscriber(subscriber, subscriberFormData2);
        this.store(response);
        return Promise.resolve(response);
      } catch (e2) {
        return Promise.reject(e2);
      }
    }
    async upsert({ subscriber = null, campaign = null } = {}) {
      const subscriber_id = isTestMode() ? "fake_subscriber" : subscriber;
      if (!subscriber_id) {
        return Promise.reject();
      }
      let subscriberFormData2 = subscriberFormData();
      if (campaign) {
        subscriberFormData2.campaign_id = campaign;
      }
      try {
        const response = await upsertSubscriber(subscriber_id, subscriberFormData2);
        this.store(response);
        return Promise.resolve(response);
      } catch (e2) {
        return Promise.reject(e2);
      }
    }
    store(subscriber) {
      subscriberData(subscriber);
      storeCookie(`${SUBSCRIBER_COOKIE}-${this.config.uuid}`, subscriber.id);
      triggerEvent("subscriber-loaded");
      console.log(`Subscriber set`, { subscriber });
    }
  };

  // app/javascript/script/upscribe.js
  var Upscribe = class {
    constructor() {
      this.config = globalConfig();
      this.upscribe = {};
    }
    async load(upscribe_id = null) {
      this.fetchSettings(upscribe_id);
      if (this.upscribe) {
        this.trackGenerationEvent();
        if (this.upscribe.recommendations.length == 0) {
          console.log("No recommendations available. Upscribe widget not loaded.");
          if (this.upscribe.after_submission.redirect) {
            window.location.href = this.generateRedirectURL();
          }
          return;
        }
        this.loadStyles();
        const overlay = document.createElement("div");
        overlay.id = "sl-overlay";
        overlay.replaceChildren(this.generateWidget());
        document.body.appendChild(overlay);
        document.body.classList.add("sl-upscribe-open");
      }
    }
    generateWidget() {
      this.trackUpscribeShownEvent();
      const subscriber = subscriberData();
      const subscriberEmail = subscriber.email;
      const upscribe2 = this.upscribe;
      let redirect_url;
      if (upscribe2.after_submission.redirect) {
        redirect_url = this.generateRedirectURL();
      }
      const formButtonEl = createElement({ type: "button", attributes: { type: "submit" }, text: upscribe2.button_label, classes: "sl-button" });
      const redirectToSLDashboard = () => {
        if (confirm("Your Upscribe widget was successfully verified. You will be redirected back to SparkLoop soon.")) {
          window.location.href = `${this.config.app_url}/partner_profile/upscribe/checklist?script_verified=true`;
        }
      };
      const mainEl = createElement({ id: "sparkloop-upscribe", classes: "sl-widget-body sl-zoomIn" });
      const hideUpscribeWidget = () => {
        mainEl.classList.remove("sl-zoomIn");
        const obj = document.querySelector("#sl-overlay") || mainEl;
        if (obj) {
          obj.addEventListener("animationend", () => {
            obj.remove();
          }, { once: true });
          obj.classList.add("sl-fadeOut");
          document.body.classList.remove("sl-upscribe-open");
        }
      };
      const thankYouMessageEl = createElement({ classes: "sl-upscribe-thank-you-message", text: upscribe2.after_submission.thank_you_message, parent: mainEl });
      const containerEl = createElement({ type: "form", attributes: { "data-sparkloop-form-ignore": true }, parent: mainEl });
      containerEl.addEventListener("submit", async function(evt) {
        evt.preventDefault();
        const recommendationsSelected = containerEl.querySelectorAll('input[type="checkbox"]:checked');
        if (recommendationsSelected.length > 0 && subscriber) {
          formButtonEl.disabled = true;
          const selected_partner_campaign_referral_codes = Array.from(recommendationsSelected).map((x) => x.value);
          const data = {
            subscriber: isTestMode() ? "fake_subscriber" : subscriber.id,
            partner_campaigns: selected_partner_campaign_referral_codes.join(",")
          };
          const recommendationEvents = upscribe2.recommendations.map((recommendation) => {
            let type = selected_partner_campaign_referral_codes.includes(recommendation.ref_code) ? "subscribed" : "skipped";
            return {
              partner_campaign_id: recommendation.uuid,
              type
            };
          });
          if (isUpscribeVerification()) {
            redirectToSLDashboard();
          } else {
            try {
              await upscribe(upscribe2.uuid, data);
              createUpscribeEvent(
                upscribe2.uuid,
                {
                  type: "subscribed_to_recommendation",
                  recommendation_events: recommendationEvents,
                  email: subscriberEmail
                }
              );
              if (upscribe2.after_submission.redirect) {
                window.location.href = redirect_url.toString();
              } else {
                containerEl.style.display = "none";
                thankYouMessageEl.classList.add("show", "sl-fadeIn");
                setTimeout(() => {
                  hideUpscribeWidget();
                }, 2500);
              }
            } catch (e2) {
              console.log(e2);
            } finally {
              formButtonEl.disabled = false;
            }
          }
        }
      });
      if (isTestMode()) {
        mainEl.classList.add("no-animation");
      }
      if (isUpscribeVerification()) {
        createElement({ parent: containerEl, classes: "sl-upscribe-verification", html: "To complete the verification, click on the submit button. <br/>Don't worry: no data will be recorded." });
      }
      const headerEl = createElement({ type: "header", parent: containerEl });
      if (upscribe2.header) {
        createElement({ type: "h2", text: upscribe2.header, parent: headerEl });
      }
      createElement({ type: "p", text: upscribe2.subheader, parent: headerEl });
      const recommendationsListEl = createElement({ type: "ul", parent: containerEl });
      upscribe2.recommendations.forEach((partner_campaign) => {
        const recommendationEl = createElement({ type: "li", parent: recommendationsListEl });
        const recommendationLabelEl = createElement({ type: "label", attributes: { for: `partner_campaign_${partner_campaign.ref_code}` }, parent: recommendationEl });
        const recommendationMainEl = createElement({ type: "main", parent: recommendationLabelEl });
        createElement({ type: "figure", attributes: { style: `background-image: url("${partner_campaign.publication_logo}")` }, parent: recommendationMainEl });
        const recommendationInfoEl = createElement({ type: "div", parent: recommendationMainEl });
        createElement({ type: "h3", text: partner_campaign.publication_name, parent: recommendationInfoEl });
        createElement({ type: "p", text: partner_campaign.description, parent: recommendationInfoEl });
        const recommendationToggleEl = createElement({ parent: recommendationLabelEl, classes: "sl-upscribe-checkbox" });
        const toggleCheckboxEl = createElement({ type: "input", id: `partner_campaign_${partner_campaign.ref_code}`, attributes: {
          "type": "checkbox",
          "checked": "true",
          "name": "partner_campaigns[]",
          "value": partner_campaign.ref_code
        }, parent: recommendationToggleEl });
        toggleCheckboxEl.addEventListener("change", function(evt) {
          const recommendationsSelected = recommendationsListEl.querySelectorAll('input[type="checkbox"]:checked');
          formButtonEl.disabled = recommendationsSelected.length === 0;
        });
        createElement({ type: "span", parent: recommendationToggleEl });
      });
      if (upscribe2.recommendations.length === 0) {
        createElement({ type: "div", classes: "sl-instructions", text: "You have no recommendations.", parent: containerEl });
      }
      const footerEl = createElement({ type: "footer", parent: containerEl });
      if (upscribe2.recommendations.length > 0) {
        footerEl.appendChild(formButtonEl);
        const skipLink = createElement({
          type: "a",
          text: upscribe2.skip_link,
          attributes: { "href": upscribe2.after_submission.redirect ? redirect_url.toString() : "#" },
          classes: "sl-skip-link",
          parent: footerEl
        });
        skipLink.addEventListener("click", function(evt) {
          if (isUpscribeVerification()) {
            evt.preventDefault();
            redirectToSLDashboard();
          } else {
            const recommendationEvents = upscribe2.recommendations.map((recommendation) => {
              return {
                partner_campaign_id: recommendation.uuid,
                type: "skipped"
              };
            });
            createUpscribeEvent(
              upscribe2.uuid,
              {
                type: "skipped_all_recommendations",
                recommendation_events: recommendationEvents,
                email: subscriberEmail
              }
            );
            if (upscribe2.after_submission.redirect) {
              const obj = document.querySelector("#sl-overlay") || mainEl;
              obj.remove();
              document.body.classList.remove("sl-upscribe-open");
            } else {
              evt.preventDefault();
              hideUpscribeWidget();
            }
          }
        });
      }
      if (upscribe2.styling.powered_by_enabled) {
        const poweredByEl = createElement({ type: "p", id: "sl-hub-powered-by", parent: footerEl });
        poweredByLink("upscribe", poweredByEl, "upscribe");
      }
      return mainEl;
    }
    trackUpscribeShownEvent() {
      if (isTestMode() || isUpscribeVerification()) {
        return;
      }
      const recommendationEvents = this.upscribe.recommendations.map((recommendation) => {
        return { type: "shown", partner_campaign_id: recommendation.uuid };
      });
      createUpscribeEvent(
        this.upscribe.uuid,
        {
          type: "shown",
          recommendation_events: recommendationEvents,
          email: subscriberData().email
        }
      );
    }
    trackGenerationEvent() {
      if (isTestMode() || isUpscribeVerification()) {
        return;
      }
      const stats = this.upscribe.recs_stats;
      createUpscribeEvent(
        this.upscribe.uuid,
        {
          type: "generated",
          recommendations_count: this.upscribe.recommendations.length,
          available_slots: stats[0],
          pinned_recommendations_count: stats[1],
          paid_recommendations_count: stats[2],
          free_recommendations_count: stats[3],
          email: subscriberData().email
        }
      );
    }
    loadStyles() {
      this.upscribe.recommendations.forEach((publication) => preloadAsset(publication.publication_logo));
      loadStylesheet("upscribe");
      document.documentElement.style.setProperty("--sl-widgets-upscribe-primary-color", this.upscribe.styling.colors.primary);
      loadCustomCSS("upscribe", this.upscribe.styling.custom_css);
    }
    fetchSettings(upscribe_id) {
      this.upscribe = retrieveUpscribeSettings(upscribe_id);
    }
    generateRedirectURL() {
      const url = new URL(this.upscribe.after_submission.redirect_url);
      const subscriber = subscriberData();
      if (subscriber.email) {
        url.searchParams.append("email", subscriber.email);
      }
      url.searchParams.append("ref", this.config.widgets.upscribe_ref);
      const queryString = window.location.search;
      const searchParams = new URLSearchParams(queryString);
      searchParams.forEach(function(value, key) {
        url.searchParams.append(key, value);
      });
      return url;
    }
  };

  // app/javascript/script/forms.js
  var Forms = class {
    constructor() {
      this.config = globalConfig();
      this.formId = 0;
      this.submittedFormsIds = [];
    }
    track() {
      if (!this.config.scan_forms) {
        return;
      }
      this.trackStandardForms();
      document.addEventListener("pico.user.registered", (evt) => this.trackPicoForms(evt));
      document.addEventListener("om.Optin.init.submit", (evt) => this.trackOptinMonsterForms(evt));
      window.addEventListener("klaviyoForms", (evt) => this.trackKlaviyoForms(evt));
      document.addEventListener("MemberSpace.conversion", (evt) => this.trackMemberSpaceForms(evt));
      document.addEventListener("ckjs:submission:complete", (evt) => this.trackConvertKitForms(evt));
      document.addEventListener("emailoctopus:form.success", (evt) => this.trackEmailOctopusForms(evt));
      this.trackElementorForms();
      this.trackSquareSpaceForms();
      this.trackDynamicForms();
    }
    trackForm(form) {
      if (form.hasAttribute("data-sparkloop-form-ignore")) {
        return;
      }
      if (form.hasAttribute("data-sv-form")) {
        return;
      }
      if (!form.hasAttribute("data-sparkloop-form-id")) {
        this.formId++;
        form.dataset.sparkloopFormId = this.formId;
        console.log("tracking form", form);
        form.addEventListener("submit", (e2) => this.combFormForEmail(form));
      }
    }
    trackStandardForms() {
      const forms = document.querySelectorAll(this.config.form_selector || "form");
      forms.forEach((form) => {
        this.trackForm(form);
      });
    }
    trackDynamicForms() {
      const callbackFn = (mutationList) => {
        mutationList.forEach((mutation) => {
          mutation.target.querySelectorAll("form").forEach((form) => {
            this.trackForm(form);
          });
        });
      };
      const observer = new MutationObserver(callbackFn);
      observer.observe(document.body, { childList: true, subtree: true });
    }
    trackKlaviyoForms(evt) {
      console.log("klaviyo form submitted", evt);
      console.log("klaviyo event type", evt.detail.type);
      let form;
      const eventType = evt.detail.type;
      if (eventType == "submit" || eventType == "stepSubmit") {
        let formContainer = document.querySelector(`.klaviyo-form-${evt.detail.formId}`);
        if (formContainer) {
          form = formContainer.querySelector("form");
        }
        const email = evt.detail.metaData.$email;
        if (email) {
          visitorData({ email: email.trim() });
        } else {
          return;
        }
        if (eventType == "submit") {
          this.captureSubscriber({ form });
        } else if (eventType == "stepSubmit") {
          setTimeout(this.captureSubscriber({ form }), 1e3);
        }
      }
    }
    trackPicoForms(evt) {
      console.log("pico form submitted", evt);
      console.log("pico event email", evt.detail.email.trim());
      visitorData({ email: evt.detail.email.trim() });
      this.captureSubscriber();
    }
    trackOptinMonsterForms(evt) {
      console.log("optinMonster form submitted", evt);
      console.log("optinMonster event email", evt.detail.Optin.data.fields.email.trim());
      visitorData({ email: evt.detail.Optin.data.fields.email.trim() });
      this.captureSubscriber();
    }
    trackElementorForms() {
      if (window.jQuery) {
        const iCanUseOn = !!jQuery.fn.on;
        const callerFn = (e2) => this.combFormForEmail(e2.target);
        iCanUseOn ? jQuery(document).on("submit_success", callerFn) : jQuery(document).bind("submit_success", callerFn);
      }
    }
    trackMemberSpaceForms({ detail }) {
      console.log("memberSpace form submitted", detail);
      const { order, plan, member } = detail;
      visitorData({ email: member.email.trim() });
      this.captureSubscriber();
    }
    trackSquareSpaceForms() {
      var $this = this;
      if (typeof Y !== "undefined" && typeof Y.all === "function") {
        Y.all("form").each(function(yform) {
          yform.on("submit", function(evt) {
            let form;
            if (typeof yform._node === "string") {
              form = document.querySelector(yform._node);
            } else {
              form = yform._node;
            }
            if (form) {
              $this.combFormForEmail(form);
            }
          });
        });
      }
    }
    trackConvertKitForms(evt) {
      console.log("ConvertKit form submitted", evt);
      console.log("ConvertKit event email", evt.detail.email_address.trim());
      visitorData({ email: evt.detail.email_address.trim() });
      if (evt.detail.recommendations) {
        visitorData({ upscribeBlocked: true });
      }
      this.captureSubscriber({ form: evt.target });
    }
    trackEmailOctopusForms(evt) {
      console.log("emailoctopus form submitted", evt);
      console.log("emailoctopus event detail", evt.detail);
      const form = document.querySelector("[eo-block='form']").querySelector("form") || document.querySelector(".emailoctopus-form");
      if (form) {
        const email = evt.detail.contact.email_address || form.querySelector("input[type=email]").value;
        visitorData({ email: email.trim() });
        this.captureSubscriber({ form });
      }
    }
    combFormForEmail(form) {
      if (this.submittedFormsIds.includes(form.dataset.formId)) {
        return;
      }
      const emailEl = detectEmailInForm(form);
      if (emailEl) {
        triggerEvent("form-submitted");
        console.log("email input detected", emailEl);
        this.submittedFormsIds.push(form.dataset.formId);
        visitorData({ email: emailEl.value.trim() });
        this.captureSubscriber({ form });
      }
    }
    async captureSubscriber({ form = null } = {}) {
      const subscriberFormData2 = subscriberFormData();
      if (!subscriberFormData2.email) {
        console.log("No email found in the form submission");
        return;
      }
      console.log("\u2705 Form submission tracked succesfully. Email captured: " + subscriberFormData2.email);
      if (isDebugMode()) {
        window.onbeforeunload = function() {
          return "Are you sure you want to leave?";
        };
      }
      if (isVerificationMode()) {
        if (isPartnerMode()) {
          this.completePartnerVerification();
          return;
        } else {
          if (isCampaignVerification()) {
            this.completeCampaignVerification(subscriberFormData2);
            return;
          }
          if (isUpscribeVerification()) {
            this.completeUpscribeVerification(form);
            return;
          }
          if (isPartnerProgramVerification()) {
            this.completePartnerProgramVerification();
            return;
          }
        }
      }
      try {
        const response = await subscribe(subscriberFormData2);
        subscriberData(response.subscriber);
        this.loadUpscribe(form);
      } catch (error2) {
        console.log(error2);
      }
    }
    async completePartnerVerification() {
      if (isDebugMode()) {
        console.log("DEBUG: completePartnerVerification() called");
      }
      try {
        const partnerCampaignId = getUrlParam("SLVerifyInstall");
        if (partnerCampaignId) {
          const response = await testPartnerReferral(partnerCampaignId);
          if (isDebugMode()) {
            console.log("DEBUG: completePartnerVerification() response", response);
          }
          success(
            "[Step 3 of 3] Referral tracking working successfully",
            "Your test referral was successful. You can now safely recommend this publication via your partner link."
          );
          setTimeout(() => {
            window.open(`${this.config.app_url}/partner_profile/partner_campaigns/${partnerCampaignId}`);
          }, 2500);
        }
      } catch (error2) {
        console.log(error2.message);
      }
    }
    async completeCampaignVerification(subscriberFormData2) {
      try {
        const campaign_id = getUrlParam("SLVerifyInstall");
        subscriberFormData2.campaign_id = campaign_id;
        await testReferral(subscriberFormData2);
        success("[Step 3 of 3] Referral tracking working successfully", "SparkLoop was able to track the referral correctly via your form.\n\nPS: If your form normally redirects to another page, don't worry. We have temporarily disabled the redirect to test the referral.\n\n\u{1F449} you'll be redirected back to SparkLoop in a few seconds...");
        setTimeout(() => {
          window.open(`${this.config.app_url}/campaigns/${campaign_id}/checklist/script?verified=true`, "_blank");
        }, 4e3);
      } catch (error2) {
        console.log(error2.message);
      }
    }
    async completeUpscribeVerification(form) {
      if (isDebugMode()) {
        console.log("DEBUG: completeUpscribeVerification() called");
      }
      try {
        const upscribeId = getUrlParam("SLVerifyInstall");
        await testUpscribeWidget(upscribeId);
        if (isDebugMode()) {
          console.log(`DEBUG: Upscribe ID ${upscribeId}`);
        }
        this.loadUpscribe(form);
        success(
          "[Step 3 of 3] Signup tracking working successfully",
          "SparkLoop was able to track the signup correctly via your form.<br/><br/>PS: If your form normally redirects to another page, don't worry. We have temporarily disabled the redirect to test the referral.<br/><br/>\u{1F449} you'll be redirected back to SparkLoop in a few seconds..."
        );
      } catch (error2) {
        console.log(error2.message);
      }
    }
    async completePartnerProgramVerification() {
      if (isDebugMode()) {
        console.log("DEBUG: completePartnerProgramVerification() called");
      }
      try {
        const partnerProgramId = getUrlParam("SLVerifyInstall");
        await testPartnerProgramReferral2(partnerProgramId);
        if (isDebugMode()) {
          console.log(`DEBUG: PartnerProgram ID ${testPartnerProgramReferral}`);
        }
        success(
          "[Step 3 of 3] Signup tracking working successfully",
          "SparkLoop was able to track the signup correctly via your form.<br/><br/>PS: If your form normally redirects to another page, don't worry. We have temporarily disabled the redirect to test the referral.<br/><br/>\u{1F449} you'll be redirected back to SparkLoop in a few seconds..."
        );
        setTimeout(() => {
          window.open(`${this.config.app_url}/partner_programs/${partnerProgramId}/checklist/script?verified=true`, "_blank");
        }, 4e3);
      } catch (error2) {
        console.log(error2.message);
      }
    }
    getUpscribeId(form) {
      if (isDebugMode()) {
        console.log(`DEBUG: getUpscribeId() called`);
      }
      if (isDebugMode()) {
        console.log(`DEBUG: form ${form}`);
      }
      if (isCampaignVerification()) {
        return;
      }
      const upscribe2 = this.config.widgets.upscribes.find((upscribe3) => {
        if (!isUpscribeVerification() && !upscribe3.enabled) {
          console.log(`Upscribe ${upscribe3.uuid} is not enabled`);
          return false;
        }
        if (upscribe3.visibility.installation != "widget") {
          console.log(`Upscribe ${upscribe3.uuid} is not set to be displayed as a widget`);
          return false;
        }
        if (upscribe3.visibility.all_pages) {
          return true;
        }
        let currentUrl = window.location.origin + window.location.pathname;
        currentUrl = currentUrl.replace(/\/$/, "");
        const rule = upscribe3.visibility.rules.find((rule2) => {
          let regexString = wildcardToRegExp(rule2);
          return currentUrl.match(regexString);
        });
        if (rule) {
          console.log(`Upscribe ${upscribe3.uuid} is set to be displayed on ${rule}`);
          return true;
        } else {
          console.log(`Can't find a matching rule for Upscribe ${upscribe3.uuid}`);
          return false;
        }
      });
      if (isDebugMode()) {
        console.log(`DEBUG: upscribe ${upscribe2}`);
      }
      if (!upscribe2) {
        return null;
      }
      ;
      if (form) {
        return form.dataset.sparkloopUpscribe !== "false" ? upscribe2.uuid : null;
      } else {
        return upscribe2.uuid;
      }
    }
    async loadUpscribe(form = null) {
      if (isDebugMode()) {
        console.log("DEBUG: loadUpscribe() called");
      }
      if (SL.config.upscribeDisabled) {
        console.log("Upscribe is disabled");
        return;
      }
      if (isPartnerMode()) {
        console.log("Upscribe is disabled in partner mode");
        return;
      }
      if (visitorData().upscribeShown) {
        console.log("Upscribe has already been shown to this visitor");
        return;
      }
      const upscribeId = this.getUpscribeId(form);
      if (isDebugMode()) {
        console.log(`DEBUG: upscribeId ${upscribeId}`);
      }
      if (upscribeId) {
        visitorData({ upscribeShown: true });
        const upscribe2 = new Upscribe();
        upscribe2.load(upscribeId);
      }
    }
  };

  // node_modules/snarkdown/dist/snarkdown.es.js
  var e = { "": ["<em>", "</em>"], _: ["<strong>", "</strong>"], "*": ["<strong>", "</strong>"], "~": ["<s>", "</s>"], "\n": ["<br />"], " ": ["<br />"], "-": ["<hr />"] };
  function n(e2) {
    return e2.replace(RegExp("^" + (e2.match(/^(\t| )+/) || "")[0], "gm"), "");
  }
  function r(e2) {
    return (e2 + "").replace(/"/g, "&quot;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
  }
  function t(a, c) {
    var o, l, g, s, p, u = /((?:^|\n+)(?:\n---+|\* \*(?: \*)+)\n)|(?:^``` *(\w*)\n([\s\S]*?)\n```$)|((?:(?:^|\n+)(?:\t|  {2,}).+)+\n*)|((?:(?:^|\n)([>*+-]|\d+\.)\s+.*)+)|(?:!\[([^\]]*?)\]\(([^)]+?)\))|(\[)|(\](?:\(([^)]+?)\))?)|(?:(?:^|\n+)([^\s].*)\n(-{3,}|={3,})(?:\n+|$))|(?:(?:^|\n+)(#{1,6})\s*(.+)(?:\n+|$))|(?:`([^`].*?)`)|(  \n\n*|\n{2,}|__|\*\*|[_*]|~~)/gm, m = [], h = "", i = c || {}, d = 0;
    function f(n2) {
      var r2 = e[n2[1] || ""], t2 = m[m.length - 1] == n2;
      return r2 ? r2[1] ? (t2 ? m.pop() : m.push(n2), r2[0 | t2]) : r2[0] : n2;
    }
    function $() {
      for (var e2 = ""; m.length; )
        e2 += f(m[m.length - 1]);
      return e2;
    }
    for (a = a.replace(/^\[(.+?)\]:\s*(.+)$/gm, function(e2, n2, r2) {
      return i[n2.toLowerCase()] = r2, "";
    }).replace(/^\n+|\n+$/g, ""); g = u.exec(a); )
      l = a.substring(d, g.index), d = u.lastIndex, o = g[0], l.match(/[^\\](\\\\)*\\$/) || ((p = g[3] || g[4]) ? o = '<pre class="code ' + (g[4] ? "poetry" : g[2].toLowerCase()) + '"><code' + (g[2] ? ' class="language-' + g[2].toLowerCase() + '"' : "") + ">" + n(r(p).replace(/^\n+|\n+$/g, "")) + "</code></pre>" : (p = g[6]) ? (p.match(/\./) && (g[5] = g[5].replace(/^\d+/gm, "")), s = t(n(g[5].replace(/^\s*[>*+.-]/gm, ""))), ">" == p ? p = "blockquote" : (p = p.match(/\./) ? "ol" : "ul", s = s.replace(/^(.*)(\n|$)/gm, "<li>$1</li>")), o = "<" + p + ">" + s + "</" + p + ">") : g[8] ? o = '<img src="' + r(g[8]) + '" alt="' + r(g[7]) + '">' : g[10] ? (h = h.replace("<a>", '<a href="' + r(g[11] || i[l.toLowerCase()]) + '">'), o = $() + "</a>") : g[9] ? o = "<a>" : g[12] || g[14] ? o = "<" + (p = "h" + (g[14] ? g[14].length : g[13] > "=" ? 1 : 2)) + ">" + t(g[12] || g[15], i) + "</" + p + ">" : g[16] ? o = "<code>" + r(g[16]) + "</code>" : (g[17] || g[1]) && (o = f(g[17] || "--"))), h += l, h += o;
    return (h + a.substring(d) + $()).replace(/^\n+|\n+$/g, "");
  }

  // app/javascript/script/components.js
  var createElement2 = createElement;
  var Components = class {
    constructor({ referral_hub = {} } = {}) {
      this.config = globalConfig();
      this.referral_hub = referral_hub;
    }
    animateCSS = (element, animation) => new Promise((resolve, reject) => {
      element.classList.add(animation);
      function handleAnimationEnd(event) {
        event.stopPropagation();
        element.classList.remove(animation);
        resolve("Animation ended");
      }
      element.addEventListener("animationend", handleAnimationEnd, { once: true });
    });
    socialSharingLink = (socials, social) => {
      let sharing_link;
      if (social === "facebook") {
        sharing_link = "https://www.facebook.com/sharer.php?u=" + encodeURIComponent(this.referralLink("facebook"));
      } else if (social === "twitter") {
        sharing_link = "https://twitter.com/intent/tweet?text=" + encodeURIComponent(socials.twitter.message + "\n\n" + this.referralLink("twitter"));
      } else if (social === "email") {
        sharing_link = "mailto:?subject=" + encodeURIComponent(socials.email.subject) + "&body=" + encodeURIComponent(socials.email.message + "\n\n" + this.referralLink("email"));
      } else if (social === "whatsapp") {
        sharing_link = "https://api.whatsapp.com/send?text=" + encodeURIComponent(socials.whatsapp.message + "\n\n" + this.referralLink("whatsapp"));
      } else if (social === "facebook_messenger") {
        sharing_link = this.messengerLink();
      } else if (social === "linkedin") {
        sharing_link = "https://www.linkedin.com/shareArticle?mini=true&url=" + encodeURIComponent(this.referralLink("linkedin"));
      } else if (social === "reddit") {
        sharing_link = "https://www.reddit.com/submit?url=" + encodeURIComponent(this.referralLink("reddit")) + "&title=" + socials.reddit.message;
      } else if (social === "telegram") {
        sharing_link = "https://t.me/share/url?url=" + encodeURIComponent(this.referralLink("telegram")) + "&text" + encodeURIComponent(socials.telegram.message);
      } else if (social === "line") {
        sharing_link = "https://line.me/R/msg/text/?" + encodeURIComponent(socials.line.message + "\n\n" + this.referralLink("line"));
      }
      return sharing_link;
    };
    referralLink = (social = null) => {
      const subscriber = subscriberData();
      if (subscriber) {
        let reflink = subscriber.referral_link;
        if (social) {
          reflink += `?utm_source=${social}`;
        }
        return reflink;
      } else {
        return this.config.app_url + "?rh_ref=ABC123";
      }
    };
    messengerLink = () => {
      let url;
      if (/Mobi|Android/i.test(navigator.userAgent)) {
        url = "fb-messenger://share?redirect_uri=" + encodeURIComponent(this.config.default_url) + "&amp;link=" + encodeURIComponent(this.referralLink("facebook_messenger"));
      } else {
        url = "https://www.facebook.com/dialog/send?app_id=189109296592814&link=" + encodeURIComponent(this.referralLink("facebook_messenger")) + "&redirect_uri=" + encodeURIComponent(this.config.default_url);
      }
      return url;
    };
    poweredByLink = (source, parent, path = "") => {
      const powered_by_url = `https://sparkloop.app/${path}?utm_campaign=powered-by&utm_source=${source}&utm_medium=${this.config.uuid}`;
      const el = createElement2({
        type: "a",
        attributes: {
          "href": powered_by_url,
          "target": "_blank"
        },
        text: "\u26A1\uFE0F by SparkLoop",
        parent
      });
      return el;
    };
    formWidget = ({ onSubmit }) => {
      const { form_widget } = this.referral_hub;
      if (form_widget.cover_image.enabled) {
        preloadAsset(form_widget.cover_image.url);
      }
      const containerEl = createElement2({ id: "sl-form-screen", classes: "sl-widget-body" });
      if (form_widget.cover_image.enabled) {
        containerEl.classList.add("sl-cover-image", "sl-cover-image--" + form_widget.cover_image.position);
        const coverImageContainerEl = createElement2({ type: "figure", parent: containerEl });
        createElement2({ type: "img", attributes: { "src": form_widget.cover_image.url }, parent: coverImageContainerEl });
      }
      const formSectionEl = createElement2({ type: "section", id: "sl-form-section", classes: "sl-form-section", parent: containerEl });
      const formSectionDivEl = createElement2({ classes: "sl-form-content", parent: formSectionEl });
      if (form_widget.header) {
        createElement2({ type: "h2", html: t(form_widget.header), parent: formSectionDivEl });
      }
      if (form_widget.subheader) {
        createElement2({ type: "p", html: t(form_widget.subheader), parent: formSectionDivEl });
      }
      const formEl = createElement2({ type: "form", parent: formSectionEl, attributes: { "data-sparkloop-form-ignore": true } });
      const formContainerEl = createElement2({ classes: "sl-form-container", parent: formEl });
      if (form_widget.form.name_input.enabled) {
        let name_input_attributes = {
          "type": "text",
          "name": "name",
          "placeholder": form_widget.form.name_input.placeholder
        };
        if (!isTestMode()) {
          name_input_attributes["required"] = true;
        }
        createElement2({ type: "input", attributes: name_input_attributes, parent: formContainerEl });
      }
      let email_input_attributes = {
        "type": "email",
        "name": "email",
        "placeholder": form_widget.form.email_input.placeholder
      };
      if (!isTestMode()) {
        email_input_attributes["required"] = true;
      }
      const emailInputEl = createElement2({ type: "input", attributes: email_input_attributes, parent: formContainerEl });
      const btnEl = createElement2({ type: "button", attributes: { "type": "submit" }, classes: "sl-button", text: form_widget.form.button.label, parent: formContainerEl });
      formEl.addEventListener("submit", (e2) => {
        e2.preventDefault();
        e2.stopPropagation();
        if (emailInputEl.value.length > 0) {
          btnEl.disabled = true;
          onSubmit(emailInputEl.value).catch((e3) => {
            console.log(e3);
            btnEl.disabled = false;
          });
        }
      });
      const footerEl = createElement2({ type: "footer", parent: formSectionEl });
      if (form_widget.tabs.how_it_works.enabled) {
        const howItWorksLinkEl = createElement2({ type: "a", attributes: { "href": "#" }, text: form_widget.tabs.how_it_works.label, parent: footerEl });
        howItWorksLinkEl.addEventListener("click", (e2) => {
          e2.preventDefault();
          e2.stopPropagation();
          this.animateCSS(formSectionEl, "sl-fadeOutLeft").then((message2) => {
            formSectionEl.style.display = "none";
            howItWorksSectionEl.style.display = "flex";
          });
        });
        createElement2({ type: "span", text: "|", parent: footerEl });
      }
      if (form_widget.tabs.terms.enabled) {
        createElement2({ type: "a", attributes: { "href": form_widget.tabs.terms.url }, text: form_widget.tabs.terms.label, parent: footerEl });
        createElement2({ type: "span", text: "|", parent: footerEl });
      }
      if (this.referral_hub.styling.powered_by_enabled) {
        this.poweredByLink("referral-hub", footerEl);
      }
      const howItWorksSectionEl = createElement2({ type: "section", id: "sl-how-it-works-section", classes: "sl-section-large", parent: containerEl });
      howItWorksSectionEl.style.display = "none";
      const howItWorksSectionBackButtonEl = createElement2({
        type: "a",
        classes: "sl-back-button",
        html: `
              <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                 viewBox="0 0 512 512" style="enable-background:new 0 0 512 512;" xml:space="preserve">
              <g>
                <path d="M256,0C114.8,0,0,114.8,0,256s114.8,256,256,256s256-114.8,256-256S397.2,0,256,0z M256,39.4
                  c119.8,0,216.6,96.8,216.6,216.6S375.8,472.6,256,472.6S39.4,375.8,39.4,256S136.2,39.4,256,39.4z M196.9,177.2L118.2,256
                  l78.8,78.8v-59.1h196.9v-39.4H196.9V177.2z"/>
              </g>
              </svg>
              <span>Back</span>
            `,
        attributes: { "href": "#" },
        parent: howItWorksSectionEl
      });
      howItWorksSectionBackButtonEl.addEventListener("click", (e2) => {
        e2.preventDefault();
        e2.stopPropagation();
        this.animateCSS(howItWorksSectionEl, "sl-fadeOutRight").then((message2) => {
          formSectionEl.style.display = "flex";
          howItWorksSectionEl.style.display = "none";
        });
      });
      createElement2({ type: "h2", text: form_widget.tabs.how_it_works.label, parent: howItWorksSectionEl });
      createElement2({ type: "article", html: t(form_widget.tabs.how_it_works.content), parent: howItWorksSectionEl });
      return containerEl;
    };
    rewardsElement = () => {
      const subscriber = subscriberData();
      if (!subscriber) {
        return;
      }
      const { hub_widget } = this.referral_hub;
      const rewardList = hub_widget.rewards.list;
      const rewardLayout = hub_widget.rewards.layout;
      const rewardsContainerEl = createElement2({ type: "ul", id: "sl-rewards-section" });
      rewardsContainerEl.classList.add(`sl-rewards-layout-${rewardLayout}`);
      rewardList.forEach((reward, index) => {
        index++;
        const rewardIsWon = subscriber.rewards_won.includes(reward.id);
        const rewardEl = createElement2({ type: "li", classes: "sl-reward", parent: rewardsContainerEl });
        if (rewardIsWon) {
          rewardEl.classList.add("sl-reward-won");
        }
        const rewardImageEl = createElement2({ type: "figure", classes: "sl-reward-image", parent: rewardEl });
        rewardImageEl.style.backgroundImage = 'url("' + reward.image + '")';
        const rewardReferralsEl = createElement2({ classes: "sl-reward-referrals", parent: rewardImageEl });
        if (rewardIsWon) {
          createElement2({
            type: "span",
            parent: rewardReferralsEl,
            html: `<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 36 36'>
                            <path fill='#fff' d="M12.8,28.7l-9.5-9.5c-0.4-0.4-0.4-1.1,0-1.6l1.5-1.5c0.4-0.4,1.1-0.4,1.6,0l7.2,7.2   l16-16c0.4-0.4,1.1-0.4,1.6,0l1.5,1.5c0.4,0.4,0.4,1.1,0,1.6L14.4,28.7C13.9,29.1,13.2,29.1,12.8,28.7z"/>
                          </svg>`
          });
        } else {
          createElement2({ type: "span", text: reward.referrals, parent: rewardReferralsEl });
        }
        const rewardInfoEl = createElement2({ classes: "sl-reward-info", parent: rewardEl });
        createElement2({ type: "h4", text: reward.name, parent: rewardInfoEl });
        if (reward.description) {
          if (rewardLayout == "horizontal") {
            const rewardDescriptionEl = createElement2({ classes: "sl-reward-description hide", parent: rewardImageEl });
            createElement2({ type: "p", text: reward.description, parent: rewardDescriptionEl });
            const rewardDescriptionButton = createElement2({
              type: "span",
              parent: rewardInfoEl,
              html: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill='currentColor'>
                          <path fill='currentColor' d="M12,2A10,10,0,1,0,22,12,10.01114,10.01114,0,0,0,12,2Zm0,18a8,8,0,1,1,8-8A8.00917,8.00917,0,0,1,12,20Zm0-8.5a1,1,0,0,0-1,1v3a1,1,0,0,0,2,0v-3A1,1,0,0,0,12,11.5Zm0-4a1.25,1.25,0,1,0,1.25,1.25A1.25,1.25,0,0,0,12,7.5Z"/>
                        </svg>`
            });
            rewardDescriptionButton.addEventListener("click", function(e2) {
              rewardDescriptionEl.classList.toggle("hide");
            });
          } else {
            createElement2({ type: "p", text: reward.description, parent: rewardInfoEl });
          }
        }
        if (rewardList.length < 6 || index == 1 || index == rewardList.length) {
          return;
        }
        if (rewardList.length % 5 == 0) {
          if (index % 5 == 0) {
            rewardEl.classList.add("sl-before-break");
            createElement2({ type: "span", classes: "sl-reward-break", parent: rewardsContainerEl });
          }
        } else if (rewardList.length % 4 == 0) {
          if (index % 4 == 0) {
            rewardEl.classList.add("sl-before-break");
            createElement2({ type: "span", classes: "sl-reward-break", parent: rewardsContainerEl });
          }
        } else if (rewardList.length % 3 == 0) {
          if (index % 3 == 0) {
            rewardEl.classList.add("sl-before-break");
            createElement2({ type: "span", classes: "sl-reward-break", parent: rewardsContainerEl });
          }
        } else if (index % 4 == 0) {
          rewardEl.classList.add("sl-before-break");
          createElement2({ type: "span", classes: "sl-reward-break", parent: rewardsContainerEl });
        }
      });
      return rewardsContainerEl;
    };
    sharingElement = () => {
      const subscriber = subscriberData();
      if (!subscriber) {
        return;
      }
      const { hub_widget } = this.referral_hub;
      const sharingContainerEl = createElement2({ type: "section", id: "sl-sharing-section" });
      const sharingLinkContainerEl = createElement2({ id: "sl-sharinglink-container", parent: sharingContainerEl });
      createElement2({ type: "p", text: hub_widget.sharing.referral_link.header, parent: sharingLinkContainerEl });
      sharingLinkContainerEl.appendChild(this.referralLinkElement());
      if (hub_widget.sharing.social_links.enabled) {
        const socialLinksContainerEl = createElement2({ id: "sl-sociallinks-container", parent: sharingContainerEl });
        createElement2({ type: "p", text: hub_widget.sharing.social_links.header, parent: socialLinksContainerEl });
        socialLinksContainerEl.appendChild(this.socialIconsElement());
      }
      if (hub_widget.sharing.email_invitation.enabled) {
        const emailInvitationContainerEl = createElement2({ id: "sl-emailinvitation-container", parent: sharingContainerEl });
        createElement2({ type: "p", text: hub_widget.sharing.email_invitation.header, parent: emailInvitationContainerEl });
        const confirmationMessage = createElement2({ type: "span" });
        emailInvitationContainerEl.appendChild(this.emailInvitationElement(confirmationMessage));
        emailInvitationContainerEl.appendChild(confirmationMessage);
      }
      return sharingContainerEl;
    };
    referralLinkElement = () => {
      const subscriber = subscriberData();
      if (!subscriber) {
        return;
      }
      const { sharing } = this.referral_hub.hub_widget;
      const container = createElement2({ type: "form", attributes: { "data-sparkloop-form-ignore": true } });
      const sharingLinkInputEl = createElement2({ type: "input", parent: container, attributes: { "type": "text", "readonly": true, "value": subscriber.referral_link } });
      const sharingLinkButtonEl = createElement2({ type: "button", classes: "sl-button", parent: container, text: sharing.referral_link.button.label });
      sharingLinkButtonEl.addEventListener("click", (event) => {
        event.preventDefault();
        copyToClipboard(sharingLinkInputEl, sharingLinkButtonEl, sharing.referral_link.button.label);
      });
      return container;
    };
    statsElement = () => {
      const subscriber = subscriberData();
      if (!subscriber) {
        return;
      }
      const { referrals } = this.referral_hub.hub_widget;
      const container = createElement2({ type: "section", id: "sl-referrals-section" });
      if (referrals.confirmed.enabled) {
        const confirmedReferralsEl = createElement2({ id: "sl-confirmed-referrals", parent: container });
        createElement2({ type: "h3", text: numberWithCommas(subscriber.referrals.confirmed), parent: confirmedReferralsEl });
        createElement2({ type: "span", text: referrals.confirmed.label, parent: confirmedReferralsEl });
      }
      if (referrals.pending.enabled) {
        const pendingReferralsEl = createElement2({ id: "sl-pending-referrals", parent: container });
        createElement2({ type: "h3", text: numberWithCommas(subscriber.referrals.pending), parent: pendingReferralsEl });
        createElement2({ type: "span", text: referrals.pending.label, parent: pendingReferralsEl });
      }
      if (referrals.next.enabled) {
        const nextReferralsEl = createElement2({ id: "sl-next-referrals", parent: container });
        createElement2({ type: "h3", text: numberWithCommas(subscriber.next_reward), parent: nextReferralsEl });
        createElement2({ type: "span", text: referrals.next.label, parent: nextReferralsEl });
      }
      return container;
    };
    socialIconsElement = () => {
      const subscriber = subscriberData();
      if (!subscriber) {
        return;
      }
      const { hub_widget } = this.referral_hub;
      const socialsContainerEl = createElement2({ id: "sl-sociallinks-icons" });
      const socials = ["twitter", "facebook", "email", "whatsapp", "linkedin", "telegram"];
      socials.forEach((social) => {
        if (hub_widget.sharing.social_links.socials[social].enabled) {
          const socialEl = createElement2({ type: "a", classes: "sl-social", id: `sl-social-${social}`, attributes: { "title": `Share on ${social}`, "href": this.socialSharingLink(hub_widget.sharing.social_links.socials, social) } });
          socialEl.style.backgroundImage = "url(https://sparkloop-static-images.s3-us-west-1.amazonaws.com/" + social + ".png)";
          socialsContainerEl.appendChild(socialEl);
        }
      });
      return socialsContainerEl;
    };
    emailInvitationElement = (confirmationMessageEl) => {
      const subscriber = subscriberData();
      if (!subscriber) {
        return;
      }
      const { email_invitation } = this.referral_hub.hub_widget.sharing;
      const container = createElement2({ type: "form", attributes: { "data-sparkloop-form-ignore": true } });
      const emailInput = createElement2({ type: "input", parent: container, classes: "sl-widget-input", attributes: { "type": "text", "placeholder": email_invitation.placeholder } });
      const buttonEl = createElement2({ type: "button", classes: "sl-button", parent: container, text: email_invitation.button.label });
      buttonEl.addEventListener("click", async (event) => {
        event.preventDefault();
        event.stopPropagation();
        buttonEl.disabled = true;
        confirmationMessageEl.innerText = "";
        const recipients = emailInput.value.trim();
        if (recipients.length > 0) {
          const params = {
            campaign_id: this.referral_hub.campaign_id,
            subscriber: subscriber.id,
            recipients
          };
          try {
            await sendEmailInvitation(params);
            emailInput.value = "";
            confirmationMessageEl.innerText = email_invitation.confirmation_message;
          } catch (error2) {
            confirmationMessageEl.innerText = "Server error. Please try again.";
          } finally {
            buttonEl.disabled = false;
          }
        }
      });
      return container;
    };
    hubWidget = () => {
      const subscriber = subscriberData();
      if (!subscriber) {
        return;
      }
      const { hub_widget } = this.referral_hub;
      hub_widget.rewards.list.forEach((reward) => {
        preloadAsset(reward.image);
      });
      const containerEl = createElement2({ id: "sl-hub-screen", classes: "sl-widget-body" });
      if (hub_widget.header && hub_widget.header.trim().length > 0 || hub_widget.subheader && hub_widget.subheader.trim().length > 0) {
        const headerEl = createElement2({ type: "header", parent: containerEl });
        if (hub_widget.header && hub_widget.header.trim().length > 0) {
          createElement2({ type: "h2", html: t(hub_widget.header), parent: headerEl });
        }
        if (hub_widget.subheader && hub_widget.subheader.trim().length > 0) {
          createElement2({ type: "p", html: t(hub_widget.subheader), parent: headerEl });
        }
      }
      if (hub_widget.rewards.enabled && hub_widget.rewards.list.length > 0) {
        containerEl.appendChild(this.rewardsElement());
      }
      const hubMainEl = createElement2({ type: "main", id: "sl-hub-main", parent: containerEl });
      hubMainEl.appendChild(this.sharingElement());
      if (hub_widget.referrals.confirmed.enabled || hub_widget.referrals.pending.enabled || hub_widget.referrals.next.enabled) {
        hubMainEl.appendChild(this.statsElement());
      }
      if (this.referral_hub.styling.powered_by_enabled) {
        const poweredByLinkContainerEl = createElement2({ id: "sl-hub-powered-by", parent: containerEl });
        this.poweredByLink("referral-hub", poweredByLinkContainerEl);
      }
      return containerEl;
    };
  };

  // app/javascript/script/widgets.js
  var Widgets = class {
    constructor() {
      this.config = globalConfig();
      this.referral_hub = {};
    }
    async load() {
      this.loadDefaultStyles();
      if (this.config.widgets.referral_hubs.length) {
        this.fetchReferralHubSettings();
        if (Object.keys(this.referral_hub).length) {
          try {
            const subscriber = new Subscriber();
            await subscriber.fetch({ campaign: this.referral_hub.campaign_id });
          } catch (error2) {
            console.error(`Subscriber was not found`);
          }
          if (isTestMode() && showFlashMessages()) {
            message(
              "Referral Hub Preview",
              'To visualize the hub widget, signup using any name<br/>and "test@test.com" as email address.<br>When test mode is enabled no email will be recorded.'
            );
          }
          this.loadReferralHubStyles();
          this.loadReferralHubWidget();
          this.generateReferralHubElements();
        }
      }
    }
    components() {
      return widgetsAllowed() ? new Components({ referral_hub: this.referral_hub }) : proxyComponents();
    }
    fetchReferralHubSettings(campaignId) {
      const referral_hubs = this.config.widgets.referral_hubs;
      if (campaignId) {
        this.referral_hub = referral_hubs.find((hub) => hub.campaign_id == campaignId);
      } else {
        const selector = document.querySelector("#sparkloop-referral-hub") || document.querySelector("[class*=sparkloop-][data-campaign-id]");
        if (selector) {
          const campaignAttribute = selector.dataset.campaignId;
          this.referral_hub = campaignAttribute ? referral_hubs.find((hub) => hub.campaign_id == campaignAttribute) : referral_hubs[0];
        }
      }
    }
    loadReferralHubWidget() {
      const selector = document.querySelector("#sparkloop-referral-hub");
      if (!selector) {
        return;
      }
      if (subscriberData()) {
        selector.replaceChildren(this.generateHubWidget());
      } else {
        selector.replaceChildren(this.generateFormWidget());
      }
    }
    generateFormWidget() {
      return this.components().formWidget({ onSubmit: (email) => this.validateAndHydrateSubscriber(email) });
    }
    generateHubWidget() {
      return this.components().hubWidget();
    }
    generateRewardsElement() {
      return this.components().rewardsElement();
    }
    generateSharingElement() {
      return this.components().sharingElement();
    }
    generateStatsElement() {
      return this.components().statsElement();
    }
    generateReferralHubElements() {
      if (subscriberData()) {
        const wrapElement = (selector, element) => {
          const parent = document.createElement("div");
          parent.className = "sl-widget-body sl-referral-hub-element";
          parent.appendChild(element);
          selector.replaceChildren(parent);
        };
        document.querySelectorAll(`.sparkloop-rewards-element[data-campaign-id=${this.referral_hub.campaign_id}]`).forEach((el) => {
          wrapElement(el, this.generateRewardsElement());
        });
        document.querySelectorAll(`.sparkloop-sharing-element[data-campaign-id=${this.referral_hub.campaign_id}]`).forEach((el) => {
          wrapElement(el, this.generateSharingElement());
        });
        document.querySelectorAll(`.sparkloop-stats-element[data-campaign-id=${this.referral_hub.campaign_id}]`).forEach((el) => {
          wrapElement(el, this.generateStatsElement());
        });
      }
    }
    async validateAndHydrateSubscriber(email) {
      try {
        const subscriber = new Subscriber();
        await subscriber.upsert({ subscriber: email, campaign: this.referral_hub.campaign_id });
        this.loadReferralHubWidget();
        this.generateReferralHubElements();
      } catch (e2) {
        triggerEvent("subscriber-not-loaded");
        console.log(`Subscriber not loaded ${e2}`);
      }
    }
    loadDefaultStyles() {
      setDefaultCssVariables();
      loadStylesheet("default");
    }
    loadReferralHubStyles() {
      loadStylesheet("referral_hub");
      document.documentElement.style.setProperty("--sl-widgets-referral-hub-primary-color", this.referral_hub.styling.colors.primary);
      document.documentElement.style.setProperty("--sl-widgets-referral-hub-secondary-color", this.referral_hub.styling.colors.secondary);
      document.documentElement.style.setProperty("--sl-widgets-referral-hub-headers-color", this.referral_hub.styling.colors.headers);
      loadCustomCSS("referral_hub", this.referral_hub.styling.custom_css);
    }
  };

  // app/javascript/script/script_verification.js
  var ScriptVerification = class {
    constructor() {
      this.config = globalConfig();
      this.signup_email = "signup@sparkloop.co";
    }
    timeoutTime() {
      return getUrlParam("timeout") ? parseInt(getUrlParam("timeout")) : 15e3;
    }
    async run() {
      if (isVerificationMode()) {
        let response;
        if (isPartnerMode()) {
          message(
            "[Step 1 of 3]  Referral testing process initiated",
            "\u23F1 checking for a valid signup form on the page"
          );
          this.verifyReferralTracking();
        } else {
          try {
            const param = getUrlParam("SLVerifyInstall");
            if (isCampaignVerification()) {
              response = await verifyScriptCampaigns({ campaign_id: param });
            } else if (isUpscribeVerification()) {
              console.log("upscribe settings", retrieveUpscribeSettings(param));
              if (retrieveUpscribeSettings(param) == void 0) {
                throw "Upscribe settings not found";
              }
              response = await verifyScriptUpscribe(param);
            } else if (isPartnerProgramVerification()) {
              response = await verifyScriptPartnerProgram(param);
            }
            console.log(`script verified successfully`, response);
            message(
              "[Step 1 of 3] Script found on page",
              `Your SparkLoop tracking script is correctly installed on this page.<br/><br/>\u{1F449} let's make sure SparkLoop can identify your email signup form(s).`
            );
            this.verifyReferralTracking();
          } catch (error2) {
            console.error(`script verification failed`, error2);
            error("Script verification failed", `Please reload the page and try again.`);
          }
        }
      }
    }
    fetchForms() {
      return document.querySelectorAll(this.config.form_selector || "form");
    }
    verifyReferralTracking() {
      setTimeout(() => {
        if (this.fetchForms().length) {
          this.verifyForm();
        } else if (isGravityFormsWithoutEmail(this.fetchForms())) {
          warning(
            "Gravity form detected",
            "SparkLoop has detected a broken Gravity form on this page. <a href='https://help.sparkloop.app/en/articles/5855767-installing-the-tracking-script-on-wordpress#h_f004b7693e' target='_blank'>See instructions</a> on how to fix it"
          );
        } else {
          warning(
            "We can't detect a valid form on this page",
            "SparkLoop will try for another 15 seconds.<br/><br/>\u{1F449} if the form is inside a popup, try opening it (make the form appear on the page)"
          );
          setTimeout(() => {
            if (this.fetchForms().length) {
              this.verifyForm();
            } else {
              error(
                "Bad news \u{1F61E}",
                "SparkLoop couldn't detect a valid form on this page.\n\nIf you get this error but the form is visible on the page, it's possible that the form is inside an iFrame or otherwise incompatible with our SparkLoop tracking script.\n\n\u{1F449} contact our support team (support@sparkloop.app) to find a solution."
              );
            }
          }, this.timeoutTime());
        }
      }, 1500);
    }
    verifyForm() {
      if (isPartnerMode()) {
        message(
          "[Step 2 of 3] Make a test referral",
          `\u{1F449} Subscribe to this publication via the opt-in form on the page, using the email address <strong>${this.signup_email}</strong><br/><br/>Then wait up to 10 seconds for a success message to be shown.`
        );
      } else {
        message(
          "[Step 2 of 3] Valid form found",
          `SparkLoop has detected a valid email signup form on this page.

Now we need to check that our tracking script can track signups correctly via your form.<br/><br/><strong>\u{1F449} fill out and submit your form using the email address ${this.signup_email}</strong>`
        );
      }
      const forms = new Forms();
      forms.track();
      setTimeout(() => {
        if (!window.SL.visitor.email) {
          if (isPartnerMode()) {
            warning(
              "Signup not yet detected",
              `We haven't been able to detect a valid referral yet.<br/><br/>If you haven't already followed the instructions in Step #2 (above), do so now.<br/><br/>If you have already subscribed with ${this.signup_email} and are seeing this message, it means referral tracking is broken for this publication. You should contact us via support@sparkloop.app and <strong>do not recommend</strong> this publication until the issue has been fixed.`
            );
          } else {
            warning(
              "Signup not yet detected",
              `SparkLoop hasn't been able to detect a valid signup yet.

\u{1F449} if you haven't submitted the form yet using ${this.signup_email}, please do so now.

If you have submitted the email signup form correctly, it's likely there's an error in the form which prevents us from tracking referrals correctly.

In this case, please contact our support team (support@sparkloop.app) and we'll help you find an easy solution!`
            );
          }
        }
      }, this.timeoutTime());
    }
  };

  // app/javascript/script/core.js
  var import_lodash = __toESM(require_lodash());
  var Sparkloop = class {
    constructor(config) {
      this.config = config;
    }
    widgets(campaign_id) {
      const widgets = new Widgets();
      widgets.fetchReferralHubSettings(campaign_id);
      widgets.loadReferralHubStyles();
      return widgets;
    }
    async upscribe(upscribeId, subscriberId) {
      try {
        const subscriber = new Subscriber();
        await subscriber.fetch({ subscriberId: subscriberId.trim() });
        const upscribe2 = new Upscribe();
        upscribe2.fetchSettings(upscribeId);
        upscribe2.loadStyles();
        return upscribe2.generateWidget();
      } catch (error2) {
        console.error(error2);
      }
    }
    async upscribePopup(upscribeId, subscriberEmail) {
      try {
        visitorData({ email: subscriberEmail.trim() });
        const response = await subscribe(subscriberFormData());
        subscriberData(response.subscriber);
        const upscribe2 = new Upscribe();
        upscribe2.load(upscribeId);
      } catch (error2) {
        console.error(error2);
      }
    }
    generate = {
      rewardsElement: (campaign_id) => this.widgets(campaign_id).generateRewardsElement(),
      sharingElement: (campaign_id) => this.widgets(campaign_id).generateSharingElement(),
      statsElement: (campaign_id) => this.widgets(campaign_id).generateStatsElement(),
      formWidget: (campaign_id) => this.widgets(campaign_id).generateFormWidget(),
      hubWidget: (campaign_id) => this.widgets(campaign_id).generateHubWidget(),
      upscribeWidget: (upscribeId, subscriberId) => this.upscribe(upscribeId, subscriberId),
      upscribePopup: (upscribeId, subscriberEmail) => this.upscribePopup(upscribeId, subscriberEmail)
    };
    reset(config) {
      this.config = (0, import_lodash.default)(config, window.SLConfig);
    }
    trackSubscriber(email) {
      if (email) {
        visitorData({ email: email.trim() });
        const forms = new Forms();
        forms.captureSubscriber();
      } else {
        console.error(`Email can't be blank.`);
      }
    }
    async getSubscriber(email, campaign = null) {
      try {
        const subscriber = new Subscriber();
        const response = await subscriber.fetch({ subscriberId: email.trim(), campaign });
        return Promise.resolve(response);
      } catch (error2) {
        console.log(error2);
        return Promise.reject(error2);
      }
    }
    async run() {
      triggerEvent("ready");
      if (isDebugMode()) {
        console.log(`DEBUG MODE IS ON`);
      }
      showTestModeBanner();
      const visitor = new Visitor();
      await visitor.profile();
      const scriptVerification = new ScriptVerification();
      scriptVerification.run();
      const forms = new Forms();
      forms.track();
      try {
        const subscriber = new Subscriber();
        await subscriber.fetch();
      } catch (error2) {
        triggerEvent("subscriber-not-loaded");
        console.log(error2);
      }
      const widgets = new Widgets();
      widgets.load();
    }
  };
  var init2 = (defaultConfig, otherConfig = null) => {
    if (!defaultConfig.active) {
      console.warn(`Sparkloop is disabled because the account is not active.`);
      return false;
    }
    const config = (0, import_lodash.default)(otherConfig || window.SL || {}, defaultConfig);
    window.SLConfig = defaultConfig;
    if (config.disabled) {
      console.warn(`SparkLoop has been manually disabled.`);
      return false;
    }
    if (config.test_mode) {
      console.warn(`SparkLoop is running in test mode.`);
    }
    console.log("\u{1F64C} SparkLoop is loaded, time to rock'n'roll!");
    console.log("Looking to grow your newsletter? Check out https://sparkloop.app/console");
    const sparkloop = new Sparkloop(config);
    window.SL = sparkloop;
    sparkloop.run();
  };
  if (false) {
    core_module.exports = async (team_uuid, otherConfig = null) => {
      const config = await fetchConfig(team_uuid);
      init2(config, otherConfig);
    };
  } else {
    const lazyInit = () => {
      setTimeout(() => {
        init2(window.SLConfig);
      }, window.sparkloop_delay || 800);
    };
    if (document.readyState !== "loading") {
      lazyInit();
    } else {
      document.addEventListener("DOMContentLoaded", () => lazyInit());
      document.addEventListener("turbo:load", () => lazyInit());
    }
  }
})();
/*! js-cookie v3.0.1 | MIT */

})();
